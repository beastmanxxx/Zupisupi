<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="applogo.png" sizes="32x32" type="image/png">
    <link rel="icon" href="applogo.png" sizes="16x16" type="image/png">

    <title>Zupisupi</title>
    <link href="https://fonts.googleapis.com/css2?family=Honk&family=Macondo&family=Mrs+Sheppards&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: white !important;
            min-height: 100vh;
        }

        /* Login Screen Styles - Hidden by default */
        .login-container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            text-align: center;
            max-width: 400px;
            width: 90%;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .logo-section {
            margin-bottom: 30px;
        }

        .logo-section img {
            height: 80px;
            width: auto;
            margin-bottom: 20px;
        }

        .logo-section h1 {
            font-size: 28px;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .logo-section p {
            color: #718096;
            font-size: 16px;
        }

        /* Authentication Form Styles */
        .auth-form {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 25px;
            margin-top: 30px;
        }

        .form-group {
            position: relative;
            margin-bottom: 5px;
        }

        .form-group input {
            width: 100%;
            padding: 18px 24px;
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            font-size: 16px;
            outline: none;
            transition: all 0.3s ease;
            background: #f8f9fa;
            box-sizing: border-box;
            line-height: 1.5;
        }

        .form-group input:focus {
            border-color: #3498db;
            background: white;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .form-group input::placeholder {
            color: #a0aec0;
        }

        .auth-btn {
            width: 100%;
            padding: 18px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            margin-top: 10px;
        }

        .auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .form-switch {
            text-align: center;
            margin-top: 20px;
        }

        .form-switch p {
            color: #718096;
            font-size: 14px;
            margin: 0;
        }

        .form-switch a {
            color: #3498db;
            text-decoration: none;
            font-weight: 600;
        }

        .form-switch a:hover {
            text-decoration: underline;
        }

        /* Main App Styles (Show by default) */
        .main-app {
            display: block;
        }

        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.08);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            height: 90px;
        }

        .logo {
            display: flex;
            align-items: center;
            text-decoration: none;
            transition: transform 0.3s ease;
        }

        .logo:hover {
            transform: scale(1.05);
        }

        .logo img {
            height: 55px;
            width: auto;
            object-fit: contain;
        }

        .nav-actions {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .icon-btn {
            background: none;
            border: none;
            padding: 15px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #4a5568;
            position: relative;
        }

        .icon-btn:hover {
            background: rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }

        .icon-btn svg {
            width: 28px;
            height: 28px;
        }

        .cart-btn {
            position: relative;
        }

        .cart-icon-container {
            position: relative;
            display: inline-block;
        }

        .cart-icon {
            filter: brightness(0.6);
            font-size: 24px;
        }

        .cart-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #e74c3c;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .logout-btn {
            background: #ff4757;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: #ff3742;
            transform: translateY(-2px);
        }

        .main-content {
            margin-top: 105px;
            padding: 0;
            text-align: center;
            background: white;
            min-height: calc(100vh - 90px);
        }

        .welcome-message {
            font-size: 24px;
            color: #2c3e50;
            margin-bottom: 30px;
        }

        /* Slideshow Styles */
        .slideshow-container {
            position: relative;
            max-width: 800px;
            margin: 15px 10px 0;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .slides {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }

        .slides.active {
            display: block;
        }

        .slides img {
            width: 100%;
            height: 100%;
            max-width: 100%;
            max-height: 200px;
            object-fit: contain;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Slideshow indicators */
        .dots-container {
            text-align: center;
            margin-top: 20px;
        }

        .dot {
            height: 12px;
            width: 12px;
            margin: 0 5px;
            background-color: #bdc3c7;
            border-radius: 50%;
            display: inline-block;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .dot.active, .dot:hover {
            background-color: #717171;
        }

        /* Categories Section Styles */
        .categories-section {
            max-width: 1200px;
            margin: 40px auto;
            padding: 0 20px;
        }

        .section-title {
            text-align: center;
            font-size: 36px;
            color: #000000;
            margin-bottom: 30px;
            font-weight: 400;
            font-family: "Mrs Sheppards", cursive;
            letter-spacing: -0.5px;
            text-shadow: 3px 3px 8px rgba(255, 215, 0, 0.8);
        }

        .categories-grid {
            display: flex;
            overflow-x: auto;
            gap: 20px;
            margin-top: 20px;
            padding: 10px 0;
            scroll-behavior: smooth;
        }

        .categories-grid::-webkit-scrollbar {
            height: 8px;
        }

        .categories-grid::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .categories-grid::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 10px;
        }

        .categories-grid::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        .category-item {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            min-width: 100px;
            flex-shrink: 0;
        }

        .category-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }

        .category-image {
            width: 100%;
            height: 75px;
            object-fit: cover;
        }

        .category-info {
            padding: 8px;
            text-align: center;
        }

        .category-name {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
            margin: 0;
            line-height: 1.2;
        }

        /* Featured Products Section Styles */
        .products-section {
            max-width: 1200px;
            margin: 40px auto;
            padding: 0 20px;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 25px;
            margin-top: 30px;
        }

        @media (max-width: 768px) {
            .products-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
        }

        @media (max-width: 480px) {
            .products-grid {
                gap: 10px;
            }
            
            .product-card {
                border-radius: 10px;
            }
        }

        .product-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .product-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }

        .product-image {
            width: 100%;
            height: 150px;
            object-fit: contain;
            display: block;
            background: #f8f9fa;
        }

        @media (max-width: 768px) {
            .product-image {
                height: 120px;
            }
        }

        @media (max-width: 480px) {
            .product-image {
                height: 100px;
            }
        }

        .product-info {
            padding: 20px;
        }

        @media (max-width: 768px) {
            .product-info {
                padding: 15px;
            }
        }

        @media (max-width: 480px) {
            .product-info {
                padding: 12px;
            }
        }

        .product-name {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
        }

        @media (max-width: 768px) {
            .product-name {
                font-size: 16px;
            }
        }

        @media (max-width: 480px) {
            .product-name {
                font-size: 14px;
            }
        }

        .product-description {
            display: none;
        }

        .product-price {
            font-size: 20px;
            font-weight: 700;
            color: #27ae60;
            margin-bottom: 15px;
        }

        @media (max-width: 768px) {
            .product-price {
                font-size: 18px;
                margin-bottom: 12px;
            }
        }

        @media (max-width: 480px) {
            .product-price {
                font-size: 16px;
                margin-bottom: 10px;
            }
        }

        .product-buttons {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        @media (max-width: 768px) {
            .product-buttons {
                gap: 6px;
            }
        }

        @media (max-width: 480px) {
            .product-buttons {
                gap: 5px;
            }
        }

        .btn-cart, .btn-order {
            width: 100%;
            padding: 12px 16px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        @media (max-width: 768px) {
            .btn-cart, .btn-order {
                padding: 10px 12px;
                font-size: 13px;
            }
        }

        @media (max-width: 480px) {
            .btn-cart, .btn-order {
                padding: 8px 10px;
                font-size: 12px;
            }
        }

        .btn-cart {
            background: #2c3e50;
            color: white;
        }

        .btn-cart:hover {
            background: #1a252f;
            transform: translateY(-2px);
        }

        .btn-order {
            background: #f1c40f;
            color: #2c3e50;
        }

        .btn-order:hover {
            background: #f39c12;
            transform: translateY(-2px);
        }

        /* Product Detail Modal */
        .product-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            display: none;
            justify-content: center;
            align-items: center;
        }

        .product-modal-content {
            background: white;
            border-radius: 12px;
            width: 85%;
            max-width: 450px;
            max-height: 75vh;
            overflow-y: auto;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.25);
        }

        .product-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
        }

        .product-modal-header h2 {
            font-size: 18px;
            margin: 0;
        }

        .product-modal-body {
            padding: 20px;
        }

        .product-modal-image {
            width: 100%;
            height: 180px;
            object-fit: contain;
            border-radius: 8px;
            margin-bottom: 15px;
            background: #f8f9fa;
        }

        .product-modal-name {
            font-size: 20px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
        }

        .product-modal-price {
            font-size: 22px;
            font-weight: 700;
            color: #e74c3c;
            margin-bottom: 15px;
        }

        .product-modal-description {
            font-size: 14px;
            color: #666;
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .product-modal-quantity {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 15px 0;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 6px;
        }

        .quantity-label {
            font-weight: 600;
            color: #2c3e50;
            font-size: 14px;
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .quantity-btn {
            width: 30px;
            height: 30px;
            border: 2px solid #3498db;
            background: white;
            color: #3498db;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .quantity-btn:hover {
            background: #3498db;
            color: white;
        }

        .quantity-input {
            width: 50px;
            height: 30px;
            text-align: center;
            border: 2px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 600;
        }

        .total-price {
            font-size: 16px;
            font-weight: 700;
            color: #27ae60;
            margin-left: auto;
        }

        .product-modal-buttons {
            display: flex;
            gap: 12px;
            margin-top: 15px;
        }

        .product-modal-buttons .btn-cart,
        .product-modal-buttons .btn-order {
            flex: 1;
            padding: 12px 16px;
            font-size: 14px;
            font-weight: 600;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        /* Cart Section Styles */
        .cart-sidebar {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100vh;
            background: white;
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
            transition: right 0.3s ease;
            z-index: 2000;
            overflow-y: auto;
        }

        .cart-sidebar.open {
            right: 0;
        }

        .cart-header {
            padding: 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .cart-header h2 {
            margin: 0;
            color: #2c3e50;
        }

        .cart-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }

        .cart-items {
            padding: 20px;
        }

        .cart-item {
            display: flex;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .cart-item-image {
            width: 60px;
            height: 60px;
            object-fit: contain;
            border-radius: 8px;
            background: #f8f9fa;
            margin-right: 15px;
        }

        .cart-item-info {
            flex: 1;
        }

        .cart-item-name {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .cart-item-price {
            color: #27ae60;
            font-weight: 700;
        }

        .cart-item-remove {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }

        .cart-empty {
            text-align: center;
            color: #666;
            padding: 40px 20px;
        }

        .cart-total {
            padding: 20px;
            border-top: 2px solid #eee;
            background: #f8f9fa;
        }

        .cart-total-amount {
            font-size: 20px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .cart-checkout {
            width: 100%;
            background: #27ae60;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }

        .cart-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1999;
            display: none;
        }

        @media (max-width: 768px) {
            .cart-sidebar {
                width: 100%;
                right: -100%;
            }
        }

        /* New App Bottom Navigation - Only visible in main app */
        .app-bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 8px 0;
            height: 65px;
        }

        /* Hide navbar by default */
        .app-bottom-nav.hidden {
            display: none !important;
        }

        .app-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 6px 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 12px;
            min-width: 60px;
            position: relative;
        }

        .app-nav-item:hover {
            background: rgba(52, 152, 219, 0.1);
            transform: translateY(-2px);
        }

        .app-nav-item.active {
            background: #3498db;
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }

        .app-nav-icon {
            font-size: 18px;
            margin-bottom: 3px;
            transition: transform 0.3s ease;
        }

        .app-nav-item.active .app-nav-icon {
            transform: scale(1.1);
        }

        .app-nav-label {
            font-size: 11px;
            font-weight: 600;
            text-align: center;
        }

        /* Cart count badge in bottom navbar */
        .cart-nav-item .app-nav-icon {
            position: relative;
        }

        .cart-nav-item .cart-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #e74c3c;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            min-width: 18px;
        }

        /* Add bottom padding to main content to avoid overlap */
        .main-app {
            padding-bottom: 75px; /* Space for new navbar */
        }

        /* Desktop responsive design with bottom navbar */
        @media (min-width: 769px) {
            .main-app {
                padding-bottom: 75px; /* Space for new navbar */
            }
            
            .login-container {
                max-width: 400px;
            }
        }

        /* App Sections Styles */
        .app-section {
            display: none;
        }

        .app-section.active {
            display: block;
        }

        /* Search Section Styles */
        .search-page {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .search-header {
            margin-bottom: 30px;
        }

        .search-bar-container {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .search-input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #ddd;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
            transition: border-color 0.3s ease;
        }

        .search-input:focus {
            border-color: #3498db;
        }

        .search-btn {
            padding: 15px 20px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s ease;
        }

        .search-btn:hover {
            background: #2980b9;
        }

        /* Orders Section Styles */
        .orders-page, .profile-page, .cart-page {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Cart Section Main Page Styles */
        .cart-content {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            padding: 20px;
            margin-top: 20px;
        }

        .cart-items-main {
            margin-bottom: 20px;
        }

        .cart-item-main {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 1px solid #f0f0f0;
            border-radius: 8px;
            margin-bottom: 15px;
            background: white;
            transition: box-shadow 0.3s ease;
        }

        .cart-item-main:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .cart-item-image-main {
            width: 80px;
            height: 80px;
            object-fit: contain;
            border-radius: 8px;
            background: #f8f9fa;
            margin-right: 15px;
            cursor: pointer;
        }

        .cart-item-info-main {
            flex: 1;
            cursor: pointer;
        }

        .cart-item-name-main {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
            font-size: 16px;
        }

        .cart-item-price-main {
            color: #27ae60;
            font-weight: 700;
            font-size: 14px;
        }

        .cart-item-remove-main {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: background 0.3s ease;
        }

        .cart-item-remove-main:hover {
            background: #c0392b;
        }

        .cart-total-main {
            border-top: 2px solid #eee;
            padding-top: 20px;
            text-align: center;
        }

        .cart-total-amount-main {
            font-size: 24px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 20px;
        }

        .cart-checkout-main {
            background: #27ae60;
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .cart-checkout-main:hover {
            background: #229954;
        }

        .cart-empty-main {
            text-align: center;
            color: #666;
            padding: 60px 20px;
            font-size: 18px;
            line-height: 1.5;
        }

        .coming-soon {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .coming-soon-icon {
            font-size: 60px;
            margin-bottom: 20px;
        }

        .coming-soon h3 {
            font-size: 24px;
            margin-bottom: 10px;
            color: #2c3e50;
        }

        /* Cart Section Styles */
        .cart-page {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .cart-content {
            max-width: 800px;
            margin: 0 auto;
        }

        .cart-items-main {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .cart-item-main {
            display: flex;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .cart-item-main:last-child {
            border-bottom: none;
        }

        .cart-item-image-main {
            width: 80px;
            height: 80px;
            object-fit: contain;
            border-radius: 8px;
            background: #f8f9fa;
            margin-right: 15px;
            cursor: pointer;
        }

        .cart-item-info-main {
            flex: 1;
            cursor: pointer;
        }

        .cart-item-name-main {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
            font-size: 16px;
        }

        .cart-item-price-main {
            color: #27ae60;
            font-weight: 700;
            font-size: 14px;
        }

        .cart-item-remove-main {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.3s ease;
        }

        .cart-item-remove-main:hover {
            background: #c0392b;
        }

        .cart-empty-main {
            text-align: center;
            color: #666;
            padding: 60px 20px;
            font-size: 16px;
        }

        .cart-total-main {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .cart-total-amount-main {
            font-size: 24px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 20px;
        }

        .cart-checkout-main {
            width: 100%;
            max-width: 300px;
            background: #27ae60;
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .cart-checkout-main:hover {
            background: #229954;
        }

        /* Custom Notification Styles */
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1001;
            pointer-events: none;
        }

        .notification {
            background: #27ae60;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transform: translateX(400px);
            opacity: 0;
            transition: all 0.3s ease;
            pointer-events: auto;
            max-width: 350px;
            word-wrap: break-word;
        }

        .notification.show {
            transform: translateX(0);
            opacity: 1;
        }

        .notification.error {
            background: #e74c3c;
        }

        .notification.warning {
            background: #f39c12;
        }

        .notification-close {
            background: none;
            border: none;
            color: white;
            float: right;
            font-size: 18px;
            cursor: pointer;
            margin-left: 10px;
            padding: 0;
            line-height: 1;
        }

        /* Profile Section Styles */
        .profile-content {
            max-width: 400px;
            margin: 0 auto;
        }

        .profile-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .profile-avatar {
            margin-bottom: 20px;
        }

        .profile-avatar img {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
        }

        .profile-info h3 {
            font-size: 24px;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .profile-info p {
            color: #666;
            font-size: 16px;
        }

        .profile-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .profile-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 15px 20px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .profile-btn:hover {
            background: #c0392b;
        }

        /* Admin Panel Styles */
        .admin-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .admin-modal-content {
            background: white;
            border-radius: 15px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 30px;
            border-bottom: 1px solid #eee;
        }

        .admin-header h2 {
            margin: 0;
            color: #2c3e50;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            color: #333;
        }

        .admin-tabs {
            display: flex;
            border-bottom: 1px solid #eee;
        }

        .tab-btn {
            flex: 1;
            padding: 15px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 16px;
            color: #666;
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            color: #3498db;
            border-bottom: 2px solid #3498db;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .tab-content h3 {
            margin-top: 0;
            color: #2c3e50;
        }

        .slide-form {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .slide-form input {
            flex: 1;
            min-width: 200px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .slide-form button {
            padding: 10px 20px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .slide-form button:hover {
            background: #2980b9;
        }

        .slide-item, .user-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border: 1px solid #eee;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .slide-info, .user-info {
            flex: 1;
        }

        .slide-title-admin, .user-name {
            font-weight: bold;
            color: #2c3e50;
        }

        .slide-url, .user-email {
            color: #666;
            font-size: 14px;
            margin-top: 5px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn-success {
            background: #27ae60;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }

        .btn-success:hover {
            background: #229954;
        }

        .admin-badge {
            background: #f39c12;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            margin-left: 10px;
        }

        .slide-content {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.7));
            color: white;
            padding: 30px 20px 20px;
            text-align: left;
        }

        .slide-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .slide-description {
            font-size: 16px;
            opacity: 0.9;
        }

        @media (max-width: 768px) {
            .login-container {
                padding: 30px 20px;
            }

            .nav-container {
                padding: 0 15px;
            }

            .nav-actions {
                gap: 15px;
            }

            .slides img {
                width: 100%;
                height: 100%;
                max-width: 100%;
                max-height: 150px;
                object-fit: contain;
            }

            .slideshow-container {
                margin: 10px 5px 0;
            }

            .categories-grid {
                gap: 15px;
                padding: 10px 15px;
            }

            .category-item {
                min-width: 90px;
            }

            .category-image {
                height: 60px;
            }

            .category-name {
                font-size: 13px;
                color: #2c3e50;
                font-weight: 600;
            }

            .category-info {
                padding: 8px;
            }

            /* Admin Panel Mobile Styles */
            .admin-modal-content {
                width: 95%;
                max-height: 90vh;
                margin: 20px;
            }

            .admin-header {
                padding: 15px 20px;
            }

            .admin-header h2 {
                font-size: 20px;
            }

            .admin-tabs {
                flex-wrap: wrap;
            }

            .tab-btn {
                padding: 12px 8px;
                font-size: 14px;
                min-width: 0;
                flex: 1;
            }

            .tab-content {
                padding: 20px 15px;
            }

            .slide-form {
                flex-direction: column;
                gap: 15px;
            }

            .slide-form input {
                min-width: auto;
                width: 100%;
            }

            .slide-form button {
                width: 100%;
                padding: 12px;
            }

            .slide-item, .user-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .action-buttons {
                width: 100%;
                justify-content: flex-end;
            }

            .slide-info, .user-info {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Custom Notification Container -->
    <div class="notification-container" id="notificationContainer"></div>

    <!-- Login Modal (Hidden by default) -->
    <div class="login-modal" id="loginModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 3000; justify-content: center; align-items: center;">
        <div class="login-container" style="display: flex; position: relative;">
            <button onclick="closeLoginModal()" style="position: absolute; top: 10px; right: 15px; background: none; border: none; font-size: 24px; cursor: pointer; color: #666;">√ó</button>
            
            <div class="logo-section">
                <img src="logo.png" alt="Logo" onerror="this.style.display='none'">
                <h1>Welcome</h1>
                <p>Login or register to use app features</p>
            </div>

            <!-- Login Form -->
            <form class="auth-form" id="loginForm" style="display: block !important;">
                <div class="form-group">
                    <input type="email" id="loginEmail" placeholder="Email" required>
                </div>
                <div class="form-group">
                    <input type="password" id="loginPassword" placeholder="Password" required>
                </div>
                <button type="submit" class="auth-btn">Login</button>
                <div class="form-switch">
                    <p>Don't have an account? <a href="#" onclick="switchToRegister()">Register here</a></p>
                </div>
            </form>

            <!-- Register Form -->
            <form class="auth-form" id="registerForm" style="display: none !important;">
                <div class="form-group">
                    <input type="text" id="registerName" placeholder="Full Name" required>
                </div>
                <div class="form-group">
                    <input type="email" id="registerEmail" placeholder="Email" required>
                </div>
                <div class="form-group">
                    <input type="password" id="registerPassword" placeholder="Password (min 6 characters)" required>
                </div>
                <div class="form-group">
                    <input type="password" id="confirmPassword" placeholder="Confirm Password" required>
                </div>
                <button type="submit" class="auth-btn">Register</button>
                <div class="form-switch">
                    <p>Already have an account? <a href="#" onclick="switchToLogin()">Login here</a></p>
                </div>
            </form>
        </div>
    </div>

    <!-- Main App (Hidden until login) -->
    <div class="main-app" id="mainApp">
        <nav class="navbar">
            <div class="nav-container">
                <a href="#" class="logo">
                    <img src="logo.png" alt="Logo">
                </a>

                <div class="nav-actions">

                    <button class="icon-btn admin-btn" id="adminBtn" style="display: none;" onclick="openAdminPanel()">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.22,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.22,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.68 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z"/>
                        </svg>
                    </button>

                    <button class="logout-btn" id="authBtn" onclick="showLoginModal()">
                        Login
                    </button>
                </div>
            </div>
        </nav>

        <div class="main-content">
            <!-- Slideshow -->
            <div class="slideshow-container" id="slideshowContainer">
                <!-- Slides will be dynamically added by admin -->
            </div>
            
            <!-- Slideshow Dots -->
            <div class="dots-container" id="dotsContainer">
                <!-- Dots will be dynamically added based on slides -->
            </div>

            <!-- Home Section -->
            <div id="homeSection" class="app-section active">
                <!-- Categories Section -->
                <div class="categories-section">
                    <h2 class="section-title">Categories</h2>
                    <div class="categories-grid" id="categoriesGrid">
                        <!-- Categories will be dynamically added -->
                    </div>
                </div>

                <div class="products-section">
                    <h2 class="section-title">Featured Products</h2>
                    <div class="products-grid" id="productsGrid">
                        <!-- Products will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Search Section -->
            <div id="searchSection" class="app-section">
                <div class="search-page">
                    <div class="search-header">
                        <h2 class="section-title">Search Products</h2>
                        <div class="search-bar-container">
                            <input type="text" id="searchInput" placeholder="Search products..." class="search-input">
                            <button class="search-btn" onclick="performSearch()">üîç</button>
                        </div>
                    </div>
                    <div class="search-results">
                        <div class="products-grid" id="searchProductsGrid">
                            <!-- Search results will be populated here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Orders Section -->
            <div id="ordersSection" class="app-section">
                <div class="orders-page">
                    <h2 class="section-title">My Orders</h2>
                    <div class="orders-content" id="ordersContent">
                        <p style="text-align: center; color: #666; padding: 40px;" id="noOrdersMessage">No orders yet. Place your first order!</p>
                    </div>
                </div>
            </div>

            <!-- Cart Section -->
            <div id="cartSection" class="app-section">
                <div class="cart-page">
                    <h2 class="section-title">Shopping Cart</h2>
                    <div class="cart-content">
                        <div class="cart-items-main" id="cartItemsMain">
                            <!-- Cart items will be populated here -->
                        </div>
                        <div class="cart-total-main" id="cartTotalMain" style="display: none;">
                            <div class="cart-total-amount-main" id="cartTotalAmountMain">Total: ‚Çπ0</div>
                            <button class="cart-checkout-main" onclick="checkout()">Checkout</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Profile Section -->
            <div id="profileSection" class="app-section">
                <div class="profile-page">
                    <h2 class="section-title">Profile</h2>
                    <div class="profile-actions">
                        <button class="profile-btn" onclick="showAddressForm()" style="background: #3498db; margin-bottom: 10px;">
                            <span>üìç</span>
                            Your Address
                        </button>
                        <button class="profile-btn" onclick="logout()">
                            <span>üö™</span>
                            Logout
                        </button>
                    </div>
                    
                    <!-- Address Form Modal -->
                    <div id="addressModal" class="product-modal" style="display: none;">
                        <div class="product-modal-content">
                            <div class="product-modal-header">
                                <h2>Your Address</h2>
                                <button class="close-btn" onclick="closeAddressModal()">&times;</button>
                            </div>
                            <div class="product-modal-body">
                                <form id="addressForm" onsubmit="event.preventDefault(); saveUserAddress();">
                                    <div style="margin-bottom: 15px;">
                                        <label style="display: block; margin-bottom: 5px; font-weight: 600;">Phone Number:</label>
                                        <input type="tel" id="userPhone" placeholder="Enter your phone number" 
                                                   style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px;" required>
                                        </div>
                                        <div style="margin-bottom: 15px;">
                                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Full Address:</label>
                                            <textarea id="userAddress" placeholder="Enter your complete address" rows="4"
                                                      style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px; resize: vertical;" required></textarea>
                                        </div>
                                        <button type="submit" style="width: 100%; padding: 12px; background: #27ae60; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer;">
                                            Save Address
                                        </button>
                                    </form>
                                    <div id="currentAddressDisplay" style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; display: none;">
                                        <h4 style="margin: 0 0 10px 0; color: #2c3e50;">Current Address:</h4>
                                        <p id="displayPhone" style="margin: 5px 0; color: #666;"></p>
                                        <p id="displayAddress" style="margin: 5px 0; color: #666;"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Panel Modal -->
    <div id="adminPanel" class="admin-modal" style="display: none;">
        <div class="admin-modal-content">
            <div class="admin-header">
                <h2>Admin Panel</h2>
                <button class="close-btn" onclick="closeAdminPanel()">&times;</button>
            </div>
            
            <div class="admin-tabs">
                <button class="tab-btn active" onclick="showTab('slides')">Slides</button>
                <button class="tab-btn" onclick="showTab('categories')">Categories</button>
                <button class="tab-btn" onclick="showTab('products')">Products</button>
                <button class="tab-btn" onclick="showTab('users')">Users</button>
                <button class="tab-btn" onclick="showTab('ordersAdmin')">Orders</button>
            </div>

            <!-- Slides Section -->
            <div id="slidesTab" class="tab-content active">
                <h3>Slideshow Management</h3>
                <div class="slide-form">
                    <input type="text" id="slideTitle" placeholder="Image Title" />
                    <input type="url" id="slideUrl" placeholder="Image Link" />
                    <button onclick="addSlide()">Add Slide</button>
                </div>
                <div class="slides-list" id="slidesList">
                    <!-- Current slides will be populated here -->
                </div>
            </div>

            <!-- Categories Section -->
            <div id="categoriesTab" class="tab-content">
                <h3>Category Management</h3>
                <div class="slide-form">
                    <input type="text" id="categoryName" placeholder="Category Name" />
                    <input type="url" id="categoryImageUrl" placeholder="Category Image URL" />
                    <button onclick="addCategory()">Add Category</button>
                </div>
                <div class="categories-list" id="categoriesAdminList">
                    <!-- Current categories will be populated here -->
                </div>
            </div>

            <!-- Products Section -->
            <div id="productsTab" class="tab-content">
                <h3>Product Management</h3>
                <form class="admin-form" onsubmit="event.preventDefault(); addProduct();">
                    <input type="text" id="productName" placeholder="Product Name" required>
                    <input type="url" id="productImageUrl" placeholder="Product Image URL" required>
                    <textarea id="productDescription" placeholder="Product Description" required></textarea>
                    <input type="number" id="productPrice" placeholder="Base Price (‚Çπ)" step="0.01" required>
                    <input type="number" id="deliveryCharge" placeholder="Delivery Charge (‚Çπ)" step="0.01" value="0">
                    <input type="text" id="productSubImages" placeholder="Sub Images URLs (comma separated)">
                    <select id="productCategory">
                        <option value="">Select Category</option>
                    </select>
                    <div style="margin: 10px 0;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 600;">Available Sizes & Pricing:</label>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <div style="display: flex; align-items: center; gap: 10px; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                                <label style="display: flex; align-items: center; gap: 5px; min-width: 60px;"><input type="checkbox" value="S" class="size-checkbox"> S</label>
                                <input type="number" id="priceS" placeholder="Price for S" step="0.01" style="flex: 1; padding: 5px; border: 1px solid #ccc; border-radius: 3px;">
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                                <label style="display: flex; align-items: center; gap: 5px; min-width: 60px;"><input type="checkbox" value="M" class="size-checkbox"> M</label>
                                <input type="number" id="priceM" placeholder="Price for M" step="0.01" style="flex: 1; padding: 5px; border: 1px solid #ccc; border-radius: 3px;">
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                                <label style="display: flex; align-items: center; gap: 5px; min-width: 60px;"><input type="checkbox" value="L" class="size-checkbox"> L</label>
                                <input type="number" id="priceL" placeholder="Price for L" step="0.01" style="flex: 1; padding: 5px; border: 1px solid #ccc; border-radius: 3px;">
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                                <label style="display: flex; align-items: center; gap: 5px; min-width: 60px;"><input type="checkbox" value="XL" class="size-checkbox"> XL</label>
                                <input type="number" id="priceXL" placeholder="Price for XL" step="0.01" style="flex: 1; padding: 5px; border: 1px solid #ccc; border-radius: 3px;">
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                                <label style="display: flex; align-items: center; gap: 5px; min-width: 60px;"><input type="checkbox" value="XXL" class="size-checkbox"> XXL</label>
                                <input type="number" id="priceXXL" placeholder="Price for XXL" step="0.01" style="flex: 1; padding: 5px; border: 1px solid #ccc; border-radius: 3px;">
                            </div>
                        </div>
                    </div>
                    <button type="submit" class="btn-primary">Add Product</button>
                </form>
                
                <!-- Search Bar for Products -->
                <div class="search-container" style="margin: 20px 0;">
                    <input type="text" id="productSearchInput" placeholder="Search products by name..." 
                           style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 16px;"
                           oninput="searchProducts()">
                </div>
                
                <div class="admin-list" id="productsAdminList">
                    <!-- Products will be populated here -->
                </div>
            </div>

            <!-- Users Section -->
            <div id="usersTab" class="tab-content">
                <h3>User Management</h3>
                <div class="users-list" id="usersList">
                    <!-- Registered users will be populated here -->
                </div>
            </div>

            <!-- Admin Orders Section -->
            <div id="ordersAdminTab" class="tab-content">
                <h3>Pending Orders</h3>
                <p style="color:#666; margin: 8px 0 16px;">Only orders with status "Pending" are shown here.</p>
                <div class="admin-list" id="adminOrdersList">
                    <!-- Pending orders will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Product Detail Modal -->
    <div id="productModal" class="product-modal">
        <div class="product-modal-content">
            <div class="product-modal-header">
                <h2>Product Details</h2>
                <button class="close-btn" onclick="closeProductModal()">&times;</button>
            </div>
            <div class="product-modal-body" id="productModalBody">
                <!-- Product details will be populated here -->
            </div>
        </div>
    </div>

    <!-- Cart Sidebar -->
    <div id="cartOverlay" class="cart-overlay" onclick="closeCart()"></div>
    <div id="cartSidebar" class="cart-sidebar">
        <div class="cart-header">
            <h2>Shopping Cart</h2>
            <button class="cart-close" onclick="closeCart()">&times;</button>
        </div>
        <div class="cart-items" id="cartItems">
            <!-- Cart items will be populated here -->
        </div>
        <div class="cart-total" id="cartTotal" style="display: none;">
            <div class="cart-total-amount" id="cartTotalAmount">Total: ‚Çπ0</div>
            <button class="cart-checkout" onclick="checkout()">Checkout</button>
        </div>

        <!-- App Bottom Navigation -->
        <div class="app-bottom-nav">
            <div class="app-nav-item active" onclick="setActiveTab('home')">
                <div class="app-nav-icon">üè†</div>
                <div class="app-nav-label">Home</div>
            </div>
            <div class="app-nav-item" onclick="setActiveTab('search')">
                <div class="app-nav-icon">üîç</div>
                <div class="app-nav-label">Search</div>
            </div>
            <div class="cart-nav-item app-nav-item" onclick="checkAuthAndSetTab('cart')">
                <div class="app-nav-icon">
                    üõí
                    <span class="cart-count" id="cartCountBottom" style="display: none;">0</span>
                </div>
                <div class="app-nav-label">Cart</div>
            </div>
            <div class="app-nav-item" onclick="checkAuthAndSetTab('orders')">
                <div class="app-nav-icon">üì¶</div>
                <div class="app-nav-label">Orders</div>
            </div>
            <div class="app-nav-item" onclick="checkAuthAndSetTab('profile')">
                <div class="app-nav-icon">üë§</div>
                <div class="app-nav-label">Profile</div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, updateProfile } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, onSnapshot, setDoc, getDoc, updateDoc, query, where } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyA_H9jJwyhfUrFoYCWZERf8R8W1o2TmqO0",
            authDomain: "desi-cart-wuaze.firebaseapp.com",
            projectId: "desi-cart-wuaze",
            storageBucket: "desi-cart-wuaze.firebasestorage.app",
            messagingSenderId: "891883106075",
            appId: "1:891883106075:web:c66fa32fe6fa8e8c36edbe"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        // Login modal functions
        window.showLoginModal = function() {
            if (currentUser) {
                logout();
                return;
            }
            document.getElementById('loginModal').style.display = 'flex';
        };

        window.closeLoginModal = function() {
            document.getElementById('loginModal').style.display = 'none';
        };

        // Form switching functions
        window.switchToRegister = function() {
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            
            loginForm.style.setProperty('display', 'none', 'important');
            registerForm.style.setProperty('display', 'block', 'important');
            
            // Clear login form
            document.getElementById('loginEmail').value = '';
            document.getElementById('loginPassword').value = '';
        };

        window.switchToLogin = function() {
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            
            registerForm.style.setProperty('display', 'none', 'important');
            loginForm.style.setProperty('display', 'block', 'important');
            
            // Clear register form
            document.getElementById('registerName').value = '';
            document.getElementById('registerEmail').value = '';
            document.getElementById('registerPassword').value = '';
            document.getElementById('confirmPassword').value = '';
        };

        // Email/Password Authentication Functions
        window.loginWithEmail = async function(email, password) {
            const loginBtn = document.querySelector('#loginForm .auth-btn');
            const originalText = loginBtn.textContent;
            
            try {
                // Show loading state
                loginBtn.textContent = 'Logging in...';
                loginBtn.disabled = true;
                
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                console.log('User logged in successfully:', user.email);
                
                showNotification(`Welcome back! Loading your data...`, 'success', 1000);
                closeLoginModal();
                setTimeout(() => {
                    window.location.reload();
                }, 1000);
                
            } catch (error) {
                console.error('Login error:', error);
                let errorMessage = 'Login failed. Please check your credentials.';
                
                switch (error.code) {
                    case 'auth/user-not-found':
                        errorMessage = 'No account found with this email.';
                        break;
                    case 'auth/wrong-password':
                    case 'auth/invalid-credential':
                        errorMessage = 'Incorrect email or password.';
                        break;
                    case 'auth/invalid-email':
                        errorMessage = 'Invalid email address.';
                        break;
                    case 'auth/too-many-requests':
                        errorMessage = 'Too many failed attempts. Try again later.';
                        break;
                    case 'auth/network-request-failed':
                        errorMessage = 'Network error. Please check your connection.';
                        break;
                }
                
                showNotification(errorMessage, 'error');
                
                // Reset button
                loginBtn.textContent = originalText;
                loginBtn.disabled = false;
            }
        };

        window.registerWithEmail = async function(name, email, password) {
            const registerBtn = document.querySelector('#registerForm .auth-btn');
            const originalText = registerBtn.textContent;
            
            try {
                // Show loading state
                registerBtn.textContent = 'Creating Account...';
                registerBtn.disabled = true;
                
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                
                // Update user profile with display name
                await updateProfile(user, {
                    displayName: name
                });
                
                // Save user data to Firestore
                await setDoc(doc(db, 'users', user.uid), {
                    name: name,
                    email: email,
                    createdAt: new Date(),
                    displayName: name
                });
                
                console.log('User registered successfully:', user.email);
                showNotification(`Welcome ${name}! Account created successfully.`, 'success', 1000);
                closeLoginModal();
                
                setTimeout(() => {
                    window.location.reload();
                }, 1000);
                
            } catch (error) {
                console.error('Registration error:', error);
                let errorMessage = 'Registration failed. Please try again.';
                
                switch (error.code) {
                    case 'auth/email-already-in-use':
                        errorMessage = 'An account with this email already exists.';
                        break;
                    case 'auth/invalid-email':
                        errorMessage = 'Invalid email address.';
                        break;
                    case 'auth/weak-password':
                        errorMessage = 'Password should be at least 6 characters.';
                        break;
                    case 'auth/network-request-failed':
                        errorMessage = 'Network error. Please check your connection.';
                        break;
                }
                
                showNotification(errorMessage, 'error');
                
                // Reset button
                registerBtn.textContent = originalText;
                registerBtn.disabled = false;
            }
        };

        // Function to completely clear all user data
        function clearAllUserData() {
            // Clear all global variables
            cartItems = [];
            userAddressData = null;
            currentUser = null;
            welcomeMessageShown = false;
            productsData = [];
            categoriesData = [];
            slidesData = [];
            
            // Clear localStorage completely
            localStorage.clear();
            
            // Clear sessionStorage
            sessionStorage.clear();
            
            // Reset UI elements
            const cartCount = document.getElementById('cartCountBottom');
            if (cartCount) {
                cartCount.textContent = '0';
                cartCount.style.display = 'none';
            }
            
            // Clear any cached DOM elements
            const cartItems = document.getElementById('cartItems');
            if (cartItems) cartItems.innerHTML = '';
            
            const cartItemsMain = document.getElementById('cartItemsMain');
            if (cartItemsMain) cartItemsMain.innerHTML = '';
            
            const ordersContent = document.getElementById('ordersContent');
            if (ordersContent) ordersContent.innerHTML = '';
            
            console.log('All user data cleared completely');
        }

        window.logout = async function() {
            try {
                console.log('Starting logout process...');
                
                // Redirect to home page immediately on click
                setActiveTab('home');
                
                // Firebase logout
                await signOut(auth);
                console.log('User signed out successfully');
                
                // Clear all user data
                clearAllUserData();
                
                // Show logout notification
                showNotification('Logged out successfully! üëã', 'success', 1000);
                
                // Reload after 1 second - same as login
                setTimeout(() => {
                    window.location.reload();
                }, 1000);
                
            } catch (error) {
                console.error('Error during sign-out:', error);
                
                // Redirect to home even on error
                setActiveTab('home');
                clearAllUserData();
                showNotification('Logged out! üëã', 'success', 1000);
                
                // Same reload pattern as login
                setTimeout(() => {
                    window.location.reload();
                }, 1000);
            }
        };

        // Track if welcome message has been shown
        let welcomeMessageShown = false;

        // Show main app after login
        function showMainApp(user) {
            console.log('showMainApp called with user:', user);
            currentUser = user;
            document.body.style.background = 'white';
            
            // Fix: Use correct element IDs
            const loginContainer = document.getElementById('loginContainer');
            const mainApp = document.querySelector('.main-app');
            
            console.log('loginContainer:', loginContainer);
            console.log('mainApp:', mainApp);
            
            if (loginContainer) {
                loginContainer.style.display = 'none';
            }
            if (mainApp) {
                mainApp.style.display = 'block';
            }
            
            // Show welcome notification only once per session
            if (!welcomeMessageShown) {
                showNotification(`Welcome, ${user.displayName || 'User'}! üéâ<br>You have successfully logged in.`, 'success', 5000);
                welcomeMessageShown = true;
            }
            
            // Update auth button to show "Logout" when user is logged in
            const authBtn = document.getElementById('authBtn');
            if (authBtn) {
                authBtn.textContent = 'Logout';
                authBtn.onclick = logout;
            }
            
            // Bottom navbar is always visible - no need to show/hide
            
            const welcomeMsg = document.querySelector('.welcome-message');
            if (welcomeMsg && user.displayName) {
                welcomeMsg.textContent = `Welcome, ${user.displayName}!`;
            }
            
            // Add user to registered users and update admin visibility
            addRegisteredUser(user);
            updateAdminVisibility(user);
            
            // Initialize slideshow
            initializeSlideshow();
            
            // Load data from Firebase
            loadSlidesFromFirebase();
            loadCategoriesFromFirebase();
            loadProductsFromFirebase();
            
            // Check and schedule existing completed/rejected orders for deletion
            checkAndScheduleExistingOrders();
            
            setTimeout(async () => {
                await loadCartFromFirebase();
                await loadUserAddressFromFirebase();
                
                // Update cart display after loading cart data
                updateCartCount();
                updateCartDisplayMain();
            }, 1000);
        }

        // Show login screen
        function showLoginScreen() {
            document.body.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            
            // Reset welcome message flag when user logs out
            welcomeMessageShown = false;
            
            // Fix: Use correct element IDs
            const loginContainer = document.getElementById('loginContainer');
            const mainApp = document.querySelector('.main-app');
            
            if (loginContainer) {
                loginContainer.style.display = 'flex';
            }
            if (mainApp) {
                mainApp.style.display = 'none';
            }
            
            // Bottom navbar is always visible - no need to hide
        }

        // Listen for authentication state changes
        onAuthStateChanged(auth, (user) => {
            console.log('Auth state changed:', user ? 'User logged in' : 'User logged out');
            if (user) {
                // User is signed in
                console.log('User details:', user.displayName, user.email);
                showMainApp(user);
            } else {
                // User is signed out - but don't show login screen, show main app for guest browsing
                console.log('Guest mode - showing main app without login');
                currentUser = null;
                document.body.style.background = 'white';
                
                const loginContainer = document.getElementById('loginContainer');
                const mainApp = document.querySelector('.main-app');
                
                if (loginContainer) {
                    loginContainer.style.display = 'none';
                }
                if (mainApp) {
                    mainApp.style.display = 'block';
                }
                
                // Update auth button to show "Login"
                const authBtn = document.getElementById('authBtn');
                if (authBtn) {
                    authBtn.textContent = 'Login';
                    authBtn.onclick = showLoginModal;
                }
                
                // Load public data for guest browsing
                setTimeout(async () => {
                    await loadSlidesFromFirebase();
                    await loadCategoriesFromFirebase();
                    await loadProductsFromFirebase();
                }, 500);
            }
        });

        // Slideshow functionality
        let slideIndex = 0;
        let slideInterval;

        function showSlide(index) {
            const slides = document.querySelectorAll('.slides');
            const dots = document.querySelectorAll('.dot');
            
            // Hide all slides and remove active class from dots
            slides.forEach(slide => slide.classList.remove('active'));
            dots.forEach(dot => dot.classList.remove('active'));
            
            // Show current slide only if slides exist
            if (slides[index] && slidesData.length > 0) {
                slides[index].classList.add('active');
                if (dots[index]) {
                    dots[index].classList.add('active');
                }
            }
        }

        function nextSlide() {
            if (slidesData.length > 0) {
                slideIndex = (slideIndex + 1) % slidesData.length;
                showSlide(slideIndex);
            }
        }

        function startSlideshow() {
            slideInterval = setInterval(nextSlide, 5000); // Change every 5 seconds
        }

        function stopSlideshow() {
            if (slideInterval) {
                clearInterval(slideInterval);
            }
        }

        // Manual slide navigation
        window.currentSlide = function(index) {
            slideIndex = index - 1; // Convert to 0-based index
            showSlide(slideIndex);
            stopSlideshow();
            startSlideshow(); // Restart auto-scroll
        };

        // Admin and User Management
        let currentUser = null;
        let adminUsers = ['moghaeashu@gmail.com']; // Permanent admin
        let registeredUsers = [];
        let slidesData = [];
        let categoriesData = [];
        let productsData = [];
        let selectedCategory = '';
        let cartItems = [];
        let userAddressData = null;

        // Load data from Firebase and localStorage
        async function loadData() {
            // Load admin and user data from localStorage
            const savedAdmins = localStorage.getItem('adminUsers');
            const savedUsers = localStorage.getItem('registeredUsers');
            
            if (savedAdmins) adminUsers = JSON.parse(savedAdmins);
            if (savedUsers) registeredUsers = JSON.parse(savedUsers);
            
            // Load slides from Firebase Firestore
            await loadSlidesFromFirebase();
            
            // Load categories from Firebase Firestore
            await loadCategoriesFromFirebase();
            
            // Load products from Firebase Firestore
            await loadProductsFromFirebase();
        }

        // Firebase User Address Functions
        async function saveUserAddressToFirebase(phone, address) {
            try {
                if (!currentUser) return false;
                
                const userDocRef = doc(db, 'users', currentUser.uid);
                await setDoc(userDocRef, {
                    email: currentUser.email,
                    name: currentUser.displayName,
                    phone: phone,
                    address: address,
                    updatedAt: new Date()
                }, { merge: true });
                
                console.log('User address saved to Firebase');
                return true;
            } catch (error) {
                console.error('Error saving user address:', error);
                return false;
            }
        }

        async function loadUserAddressFromFirebase() {
            try {
                if (!currentUser) return null;
                
                const userDocRef = doc(db, 'users', currentUser.uid);
                const userDoc = await getDoc(userDocRef);
                
                if (userDoc.exists()) {
                    const userData = userDoc.data();
                    userAddressData = {
                        phone: userData.phone || '',
                        address: userData.address || ''
                    };
                    return userAddressData;
                }
                return null;
            } catch (error) {
                console.error('Error loading user address:', error);
                return null;
            }
        }

        // Firebase Cart Functions
        async function saveCartToFirebase() {
            try {
                if (!currentUser) return;
                
                const cartDocRef = doc(db, 'carts', currentUser.uid);
                if (cartItems.length === 0) {
                    // If cart is empty, delete the document
                    await deleteDoc(cartDocRef);
                    console.log('Empty cart removed from Firebase');
                } else {
                    await setDoc(cartDocRef, {
                        userId: currentUser.uid,
                        items: cartItems,
                        updatedAt: new Date()
                    });
                    console.log('Cart saved to Firebase');
                }
            } catch (error) {
                console.error('Error saving cart:', error);
            }
        }

        async function loadCartFromFirebase() {
            try {
                if (!currentUser) return;
                
                const cartDocRef = doc(db, 'carts', currentUser.uid);
                const cartDoc = await getDoc(cartDocRef);
                
                if (cartDoc.exists()) {
                    const cartData = cartDoc.data();
                    cartItems = cartData.items || [];
                    updateCartCount();
                    console.log('Cart loaded from Firebase:', cartItems.length, 'items');
                }
            } catch (error) {
                console.error('Error loading cart:', error);
            }
        }

        // Firebase Orders Functions
        async function saveOrderToFirebase(orderData) {
            try {
                if (!currentUser) return false;
                
                const orderDocRef = await addDoc(collection(db, 'orders'), {
                    userId: currentUser.uid,
                    userEmail: currentUser.email,
                    userName: currentUser.displayName,
                    ...orderData,
                    createdAt: new Date()
                });
                
                console.log('Order saved to Firebase with ID:', orderDocRef.id);
                return orderDocRef.id;
            } catch (error) {
                console.error('Error saving order:', error);
                return false;
            }
        }

        async function cancelOrderFromFirebase(orderId) {
            try {
                await deleteDoc(doc(db, 'orders', orderId));
                console.log('Order cancelled and removed from Firebase');
                return true;
            } catch (error) {
                console.error('Error cancelling order:', error);
                return false;
            }
        }

        async function loadOrdersFromFirebase() {
            try {
                if (!currentUser) return [];
                
                const ordersQuery = query(
                    collection(db, 'orders'),
                    where('userId', '==', currentUser.uid)
                );
                
                const querySnapshot = await getDocs(ordersQuery);
                const orders = [];
                
                querySnapshot.forEach((doc) => {
                    orders.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                
                // Sort by creation date (newest first)
                orders.sort((a, b) => b.createdAt.toDate() - a.createdAt.toDate());
                
                console.log('Orders loaded from Firebase:', orders.length, 'orders');
                return orders;
            } catch (error) {
                console.error('Error loading orders:', error);
                return [];
            }
        }

        // Admin: Load all pending orders across users
        async function loadPendingOrdersForAdmin() {
            try {
                const adminOrdersList = document.getElementById('adminOrdersList');
                if (!adminOrdersList) return;
                adminOrdersList.innerHTML = '<p style="text-align:center; color:#666; padding: 16px;">Loading pending orders...</p>';

                const pendingQuery = query(
                    collection(db, 'orders'),
                    where('status', '==', 'Pending')
                );
                const snapshot = await getDocs(pendingQuery);

                const pendingOrders = [];
                snapshot.forEach(d => pendingOrders.push({ id: d.id, ...d.data() }));

                // Sort newest first if createdAt exists
                pendingOrders.sort((a, b) => {
                    const aTime = a.createdAt && a.createdAt.toDate ? a.createdAt.toDate().getTime() : 0;
                    const bTime = b.createdAt && b.createdAt.toDate ? b.createdAt.toDate().getTime() : 0;
                    return bTime - aTime;
                });

                adminOrdersList.innerHTML = '';
                if (pendingOrders.length === 0) {
                    adminOrdersList.innerHTML = '<p style="text-align:center; color:#666; padding: 20px;">No pending orders.</p>';
                    return;
                }

                pendingOrders.forEach(order => {
                    const el = document.createElement('div');
                    el.className = 'order-item';
                    el.style.cssText = 'background:#fff;border:1px solid #eee;border-radius:10px;padding:12px;margin-bottom:12px;box-shadow:0 4px 12px rgba(0,0,0,0.06)';
                    el.innerHTML = `
                        <div style="display:flex; gap:10px; align-items:flex-start;">
                            <img src="${order.productImage || ''}" alt="${order.productName || ''}" style="width:60px;height:60px;object-fit:contain;border-radius:6px;background:#f8f9fa;border:1px solid #e9ecef;" onerror="this.style.display='none'">
                            <div style="flex:1;">
                                <div style="font-weight:700; color:#2c3e50;">${order.productName || 'Product'}</div>
                                <div style="font-size:12px; color:#666;">Qty: ${order.quantity || 1} ‚Ä¢ Total: ‚Çπ${(order.totalAmount || 0) + (order.deliveryCharge || 0)}</div>
                                <div style="font-size:12px; color:#666;">User: ${order.userName || ''} (${order.userEmail || ''})</div>
                                <div style="font-size:12px; color:#666;">üìû ${order.userPhone || ''} ‚Ä¢ üìç ${order.userAddress || ''}</div>
                                <div style="font-size:12px; color:#666;">ID: <span style="font-family:monospace;">${order.id}</span></div>
                            </div>
                        </div>
                        <div style="display:flex; gap:10px; margin-top:10px;">
                            <button class="btn-success" style="flex:1;" onclick="adminCompleteOrder('${order.id}')">Complete</button>
                            <button class="btn-danger" style="flex:1;" onclick="adminRejectOrder('${order.id}')">Reject</button>
                        </div>
                    `;
                    adminOrdersList.appendChild(el);
                });
            } catch (error) {
                console.error('Error loading pending orders for admin:', error);
                const adminOrdersList = document.getElementById('adminOrdersList');
                if (adminOrdersList) adminOrdersList.innerHTML = '<p style="text-align:center; color:#e74c3c; padding: 20px;">Failed to load pending orders.</p>';
            }
        }

        // Admin: update order status to Completed
        window.adminCompleteOrder = async function(orderId) {
            try {
                await updateDoc(doc(db, 'orders', orderId), { 
                    status: 'Completed',
                    completedAt: new Date()
                });
                showNotification('Order marked as Completed ‚úÖ', 'success');
                
                // Schedule automatic deletion after 30 minutes
                scheduleOrderDeletion(orderId, 30 * 60 * 1000); // 30 minutes in milliseconds
                
                loadPendingOrdersForAdmin();
                // Also refresh user orders if currently viewing
                loadOrdersDataFromFirebase();
            } catch (e) {
                console.error('Error completing order:', e);
                showNotification('Failed to complete order', 'error');
            }
        }

        // Admin: update order status to Rejected
        window.adminRejectOrder = async function(orderId) {
            try {
                await updateDoc(doc(db, 'orders', orderId), { 
                    status: 'Rejected',
                    rejectedAt: new Date()
                });
                showNotification('Order marked as Rejected ‚ùå', 'success');
                
                // Schedule automatic deletion after 30 minutes
                scheduleOrderDeletion(orderId, 30 * 60 * 1000); // 30 minutes in milliseconds
                
                loadPendingOrdersForAdmin();
                loadOrdersDataFromFirebase();
            } catch (e) {
                console.error('Error rejecting order:', e);
                showNotification('Failed to reject order', 'error');
            }
        }

        // Schedule order deletion after specified time
        function scheduleOrderDeletion(orderId, delayMs) {
            console.log(`Scheduling deletion of order ${orderId} in ${delayMs / 1000 / 60} minutes`);
            
            setTimeout(async () => {
                try {
                    await deleteDoc(doc(db, 'orders', orderId));
                    console.log(`Order ${orderId} automatically deleted after completion/rejection`);
                    
                    // Refresh orders display if user is currently viewing orders
                    if (currentUser) {
                        loadOrdersDataFromFirebase();
                    }
                    
                    // Refresh admin orders if admin panel is open
                    loadPendingOrdersForAdmin();
                    
                } catch (error) {
                    console.error(`Error auto-deleting order ${orderId}:`, error);
                }
            }, delayMs);
        }

        // Start countdown timer for order deletion
        function startCountdownTimer(orderId, statusChangeTime) {
            const countdownElement = document.getElementById(`countdown-${orderId}`);
            if (!countdownElement) return;
            
            const statusDate = statusChangeTime?.toDate ? statusChangeTime.toDate() : new Date(statusChangeTime);
            const thirtyMinutes = 30 * 60 * 1000; // 30 minutes in milliseconds
            
            function updateTimer() {
                const now = new Date();
                const timeSinceStatusChange = now.getTime() - statusDate.getTime();
                const remainingTime = thirtyMinutes - timeSinceStatusChange;
                
                if (remainingTime <= 0) {
                    countdownElement.textContent = 'Deleting...';
                    const timerDiv = document.getElementById(`timer-${orderId}`);
                    if (timerDiv) {
                        timerDiv.style.background = '#f8d7da';
                        timerDiv.style.color = '#721c24';
                        timerDiv.innerHTML = 'üóëÔ∏è Order will be deleted shortly...';
                    }
                    
                    // Actually delete the order when timer reaches 0
                    setTimeout(async () => {
                        try {
                            await deleteDoc(doc(db, 'orders', orderId));
                            console.log(`Order ${orderId} deleted by timer`);
                            
                            // Refresh orders display
                            if (currentUser) {
                                loadOrdersDataFromFirebase();
                            }
                            
                            showNotification('Order automatically deleted üóëÔ∏è', 'info', 3000);
                        } catch (error) {
                            console.error(`Error deleting order ${orderId} by timer:`, error);
                        }
                    }, 2000); // Delete after 2 seconds of showing "deleting" message
                    
                    return;
                }
                
                const minutes = Math.floor(remainingTime / (1000 * 60));
                const seconds = Math.floor((remainingTime % (1000 * 60)) / 1000);
                countdownElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }
            
            // Update immediately
            updateTimer();
            
            // Update every second
            const interval = setInterval(() => {
                updateTimer();
                
                // Stop timer when time is up
                const now = new Date();
                const timeSinceStatusChange = now.getTime() - statusDate.getTime();
                if (timeSinceStatusChange >= thirtyMinutes) {
                    clearInterval(interval);
                }
            }, 1000);
        }

        // Check for existing completed/rejected orders on app load and schedule their deletion
        async function checkAndScheduleExistingOrders() {
            try {
                const completedQuery = query(
                    collection(db, 'orders'),
                    where('status', 'in', ['Completed', 'Rejected'])
                );
                
                const snapshot = await getDocs(completedQuery);
                
                snapshot.forEach((doc) => {
                    const orderData = doc.data();
                    const completedAt = orderData.completedAt?.toDate();
                    const rejectedAt = orderData.rejectedAt?.toDate();
                    const statusChangeTime = completedAt || rejectedAt;
                    
                    if (statusChangeTime) {
                        const timeSinceStatusChange = Date.now() - statusChangeTime.getTime();
                        const thirtyMinutes = 30 * 60 * 1000;
                        
                        if (timeSinceStatusChange >= thirtyMinutes) {
                            // Order is already past 30 minutes, delete immediately
                            deleteDoc(doc.ref).then(() => {
                                console.log(`Expired order ${doc.id} deleted immediately`);
                            }).catch(error => {
                                console.error(`Error deleting expired order ${doc.id}:`, error);
                            });
                        } else {
                            // Schedule deletion for remaining time
                            const remainingTime = thirtyMinutes - timeSinceStatusChange;
                            scheduleOrderDeletion(doc.id, remainingTime);
                        }
                    }
                });
            } catch (error) {
                console.error('Error checking existing orders for deletion:', error);
            }
        }

        // Save admin/user data to localStorage
        function saveData() {
            localStorage.setItem('adminUsers', JSON.stringify(adminUsers));
            localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));
        }

        // Load slides from Firebase Firestore
        async function loadSlidesFromFirebase() {
            try {
                console.log('Loading slides from Firebase...');
                const querySnapshot = await getDocs(collection(db, 'slides'));
                slidesData = [];
                querySnapshot.forEach((doc) => {
                    console.log('Found slide:', doc.id, doc.data());
                    slidesData.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                // Sort slides by order if available, otherwise by creation time
                slidesData.sort((a, b) => (a.order || 0) - (b.order || 0));
                console.log('Total slides loaded:', slidesData.length);
                
                // Add fallback slides if no slides found
                if (slidesData.length === 0) {
                    console.log('No slides found, adding fallback slides');
                    slidesData = [
                        {
                            id: 'fallback1',
                            title: 'Welcome to Zupisupi',
                            url: 'https://via.placeholder.com/800x400/3498db/ffffff?text=Welcome+to+Zupisupi',
                            order: 0
                        },
                        {
                            id: 'fallback2', 
                            title: 'Shop Amazing Products',
                            url: 'https://via.placeholder.com/800x400/27ae60/ffffff?text=Shop+Amazing+Products',
                            order: 1
                        }
                    ];
                }
                
                updateSlideshow();
            } catch (error) {
                console.error('Error loading slides from Firebase:', error);
                // Fallback slides for error case
                slidesData = [
                    {
                        id: 'fallback1',
                        title: 'Welcome to Zupisupi',
                        url: 'https://via.placeholder.com/800x400/3498db/ffffff?text=Welcome+to+Zupisupi',
                        order: 0
                    }
                ];
                updateSlideshow();
            }
        }

        // Convert Google Drive sharing URL to direct image URL
        function convertGoogleDriveUrl(url) {
            if (url.includes('drive.google.com/file/d/')) {
                const fileId = url.match(/\/file\/d\/([a-zA-Z0-9_-]+)/);
                if (fileId && fileId[1]) {
                    // Try multiple formats for better compatibility
                    return `https://lh3.googleusercontent.com/d/${fileId[1]}=w800-h400-c`;
                }
            }
            return url; // Return original URL if not a Google Drive link
        }

        // Add slide to Firebase Firestore
        async function addSlideToFirebase(title, url) {
            try {
                // Convert Google Drive URL to direct image URL
                const convertedUrl = convertGoogleDriveUrl(url);
                console.log('Original URL:', url);
                console.log('Converted URL:', convertedUrl);
                
                const docRef = await addDoc(collection(db, 'slides'), {
                    title: title,
                    url: convertedUrl,
                    originalUrl: url,
                    order: slidesData.length,
                    createdAt: new Date(),
                    createdBy: currentUser?.email || 'unknown'
                });
                console.log('Slide added with ID: ', docRef.id);
                await loadSlidesFromFirebase(); // Refresh slides
                return true;
            } catch (error) {
                console.error('Error adding slide to Firebase:', error);
                return false;
            }
        }

        // Remove slide from Firebase Firestore
        async function removeSlideFromFirebase(slideId) {
            try {
                await deleteDoc(doc(db, 'slides', slideId));
                console.log('Slide removed from Firebase');
                await loadSlidesFromFirebase(); // Refresh slides
                return true;
            } catch (error) {
                console.error('Error removing slide from Firebase:', error);
                return false;
            }
        }

        // Load categories from Firebase Firestore
        async function loadCategoriesFromFirebase() {
            try {
                console.log('Loading categories from Firebase...');
                const querySnapshot = await getDocs(collection(db, 'categories'));
                categoriesData = [];
                querySnapshot.forEach((doc) => {
                    console.log('Found category:', doc.id, doc.data());
                    categoriesData.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                // Sort categories by order if available, otherwise by creation time
                categoriesData.sort((a, b) => (a.order || 0) - (b.order || 0));
                console.log('Total categories loaded:', categoriesData.length);
                
                // Add fallback categories if no categories found
                if (categoriesData.length === 0) {
                    console.log('No categories found, adding fallback categories');
                    categoriesData = [
                        {
                            id: 'clothing',
                            name: 'Clothing',
                            imageUrl: 'https://via.placeholder.com/200x150/e74c3c/ffffff?text=Clothing',
                            order: 0
                        },
                        {
                            id: 'footwear',
                            name: 'Footwear',
                            imageUrl: 'https://via.placeholder.com/200x150/3498db/ffffff?text=Footwear',
                            order: 1
                        },
                        {
                            id: 'accessories',
                            name: 'Accessories',
                            imageUrl: 'https://via.placeholder.com/200x150/27ae60/ffffff?text=Accessories',
                            order: 2
                        }
                    ];
                }
                
                updateCategoriesDisplay();
            } catch (error) {
                console.error('Error loading categories from Firebase:', error);
                // Fallback categories for error case
                categoriesData = [
                    {
                        id: 'general',
                        name: 'General',
                        imageUrl: 'https://via.placeholder.com/200x150/95a5a6/ffffff?text=General',
                        order: 0
                    }
                ];
                updateCategoriesDisplay();
            }
        }

        // Add category to Firebase Firestore
        async function addCategoryToFirebase(name, imageUrl) {
            try {
                const convertedUrl = convertGoogleDriveUrl(imageUrl);
                console.log('Adding category:', name, convertedUrl);
                
                const docRef = await addDoc(collection(db, 'categories'), {
                    name: name,
                    imageUrl: convertedUrl,
                    originalImageUrl: imageUrl,
                    order: categoriesData.length,
                    createdAt: new Date(),
                    createdBy: currentUser?.email || 'unknown'
                });
                console.log('Category added with ID: ', docRef.id);
                await loadCategoriesFromFirebase();
                return true;
            } catch (error) {
                console.error('Error adding category to Firebase:', error);
                return false;
            }
        }

        // Remove category from Firebase Firestore
        async function removeCategoryFromFirebase(categoryId) {
            try {
                await deleteDoc(doc(db, 'categories', categoryId));
                console.log('Category removed from Firebase');
                await loadCategoriesFromFirebase();
                return true;
            } catch (error) {
                console.error('Error removing category from Firebase:', error);
                return false;
            }
        }

        // Update categories display on main page
        function updateCategoriesDisplay() {
            const categoriesGrid = document.getElementById('categoriesGrid');
            if (!categoriesGrid) return;
            
            categoriesGrid.innerHTML = '';
            
            categoriesData.forEach(category => {
                const categoryItem = document.createElement('div');
                categoryItem.className = 'category-item';
                categoryItem.onclick = () => filterProductsByCategory(category.name);
                categoryItem.innerHTML = `
                    <img src="${category.imageUrl}" alt="${category.name}" class="category-image" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgdmlld0JveD0iMCAwIDIwMCAxNTAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMTUwIiBmaWxsPSIjZjNmNGY2Ii8+Cjx0ZXh0IHg9IjEwMCIgeT0iNzUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OWFhMiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk5vIEltYWdlPC90ZXh0Pgo8L3N2Zz4K'">
                    <div class="category-info">
                        <h3 class="category-name">${category.name}</h3>
                    </div>
                `;
                categoriesGrid.appendChild(categoryItem);
            });
            
            // Update category dropdown in admin panel
            updateCategoryDropdown();
        }

        // Update category dropdown in admin panel
        function updateCategoryDropdown() {
            const categorySelect = document.getElementById('productCategory');
            if (!categorySelect) return;
            
            categorySelect.innerHTML = '<option value="">Select Category</option>';
            categoriesData.forEach(category => {
                const option = document.createElement('option');
                option.value = category.name;
                option.textContent = category.name;
                categorySelect.appendChild(option);
            });
        }

        // Filter products by category
        function filterProductsByCategory(categoryName) {
            selectedCategory = categoryName;
            updateProductsDisplay();
        }

        // Admin category management functions
        window.addCategory = async function() {
            const name = document.getElementById('categoryName').value;
            const imageUrl = document.getElementById('categoryImageUrl').value;
            
            if (!name || !imageUrl) {
                showNotification('Please fill in both category name and image URL', 'warning');
                return;
            }
            
            if (categoriesData.length >= 10) {
                showNotification('Maximum 10 categories allowed', 'warning');
                return;
            }
            
            const success = await addCategoryToFirebase(name, imageUrl);
            if (success) {
                loadCategoriesAdminData();
                // Clear form
                document.getElementById('categoryName').value = '';
                document.getElementById('categoryImageUrl').value = '';
            } else {
                showNotification('Error adding category. Please try again.', 'error');
            }
        };

        window.removeCategory = async function(categoryId) {
            console.log('Attempting to remove category with ID:', categoryId);
            const success = await removeCategoryFromFirebase(categoryId);
            if (success) {
                loadCategoriesAdminData();
            } else {
                showNotification('Error removing category. Please try again.', 'error');
            }
        }

        function loadCategoriesAdminData() {
            const categoriesAdminList = document.getElementById('categoriesAdminList');
            if (!categoriesAdminList) return;
            
            categoriesAdminList.innerHTML = '';
            
            categoriesData.forEach((category, index) => {
                const categoryItem = document.createElement('div');
                categoryItem.className = 'slide-item';
                categoryItem.innerHTML = `
                    <div class="slide-info">
                        <div class="slide-title-admin">${category.name}</div>
                        <div class="slide-url">${category.originalImageUrl || category.imageUrl}</div>
                        <small style="color: #999;">ID: ${category.id}</small>
                    </div>
                    <div class="action-buttons">
                        <button class="btn-danger" onclick="removeCategory('${category.id}')">Remove</button>
                    </div>
                `;
                categoriesAdminList.appendChild(categoryItem);
            });
        }

        // Load products from Firebase Firestore
        async function loadProductsFromFirebase() {
            try {
                console.log('Loading products from Firebase...');
                const querySnapshot = await getDocs(collection(db, 'products'));
                productsData = [];
                querySnapshot.forEach((doc) => {
                    console.log('Found product:', doc.id, doc.data());
                    productsData.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                // Sort products by order if available, otherwise by creation time
                productsData.sort((a, b) => (a.order || 0) - (b.order || 0));
                console.log('Total products loaded:', productsData.length);
                
                // Add fallback products if no products found
                if (productsData.length === 0) {
                    console.log('No products found, adding fallback products');
                    productsData = [
                        {
                            id: 'sample1',
                            name: 'Sample T-Shirt',
                            price: 299,
                            imageUrl: 'https://via.placeholder.com/300x300/e74c3c/ffffff?text=T-Shirt',
                            description: 'Comfortable cotton t-shirt',
                            category: 'Clothing'
                        },
                        {
                            id: 'sample2',
                            name: 'Sample Jeans',
                            price: 599,
                            imageUrl: 'https://via.placeholder.com/300x300/3498db/ffffff?text=Jeans',
                            description: 'Stylish denim jeans',
                            category: 'Clothing'
                        },
                        {
                            id: 'sample3',
                            name: 'Sample Shoes',
                            price: 899,
                            imageUrl: 'https://via.placeholder.com/300x300/27ae60/ffffff?text=Shoes',
                            description: 'Comfortable running shoes',
                            category: 'Footwear'
                        }
                    ];
                }
                
                updateProductsDisplay();
            } catch (error) {
                console.error('Error loading products from Firebase:', error);
                // Fallback products for error case
                productsData = [
                    {
                        id: 'sample1',
                        name: 'Sample Product',
                        price: 299,
                        imageUrl: 'https://via.placeholder.com/300x300/95a5a6/ffffff?text=Product',
                        description: 'Sample product description',
                        category: 'General'
                    }
                ];
                updateProductsDisplay();
            }
        }

        // Add product to Firebase Firestore
        async function addProductToFirebase(name, imageUrl, description, basePrice, subImages, category, sizes, sizePricing, deliveryCharge) {
            try {
                const convertedUrl = convertGoogleDriveUrl(imageUrl);
                const subImagesArray = subImages ? subImages.split(',').map(url => convertGoogleDriveUrl(url.trim())) : [];
                
                const productData = {
                    name: name,
                    imageUrl: convertedUrl,
                    description: description,
                    price: parseFloat(basePrice),
                    basePrice: parseFloat(basePrice),
                    deliveryCharge: parseFloat(deliveryCharge),
                    subImages: subImagesArray,
                    category: category,
                    sizes: sizes || [],
                    sizePricing: sizePricing || {},
                    createdAt: new Date().toISOString()
                };
                
                const docRef = await addDoc(collection(db, 'products'), productData);
                console.log('Product added with ID:', docRef.id);
                
                // Reload products data
                await loadProductsFromFirebase();
                loadProductsAdminData();
                
                return true;
            } catch (error) {
                console.error('Error adding product:', error);
                return false;
            }
        }

        // Remove product from Firebase Firestore
        async function removeProductFromFirebase(productId) {
            try {
                await deleteDoc(doc(db, 'products', productId));
                console.log('Product removed from Firebase');
                await loadProductsFromFirebase();
                return true;
            } catch (error) {
                console.error('Error removing product from Firebase:', error);
                return false;
            }
        }

        // Update products display on main page
        function updateProductsDisplay() {
            const productsGrid = document.getElementById('productsGrid');
            if (!productsGrid) return;

            productsGrid.innerHTML = '';

            // Filter products by selected category
            const filteredProducts = selectedCategory 
                ? productsData.filter(product => product.category === selectedCategory)
                : productsData;

            // Show all products in rows of 2
            const displayProducts = filteredProducts;

            displayProducts.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                productCard.onclick = () => openProductModal(product.id);
                productCard.innerHTML = `
                    <img src="${product.imageUrl}" alt="${product.name}" class="product-image" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgdmlld0JveD0iMCAwIDIwMCAxNTAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMTUwIiBmaWxsPSIjZjNmNGY2Ii8+Cjx0ZXh0IHg9IjEwMCIgeT0iNzUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OWFhMiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk5vIEltYWdlPC90ZXh0Pgo8L3N2Zz4K'">
                    <div class="product-info">
                        <h3 class="product-name">${product.name}</h3>
                        <div class="product-price">‚Çπ${product.price}</div>
                        <div class="product-buttons">
                            <button class="btn-cart" onclick="event.stopPropagation(); addToCart('${product.id}')">Add to Cart</button>
                            <button class="btn-order" onclick="event.stopPropagation(); orderNow('${product.id}')">Order Now</button>
                        </div>
                    </div>
                `;
                productsGrid.appendChild(productCard);
            });

            // Show message if no products found for selected category
            if (filteredProducts.length === 0 && selectedCategory) {
                productsGrid.innerHTML = `<p style="text-align: center; color: #666; grid-column: 1 / -1;">No products found in "${selectedCategory}" category.</p>`;
            }
        }

        // Admin product management functions
        window.addProduct = async function() {
            const name = document.getElementById('productName').value;
            const imageUrl = document.getElementById('productImageUrl').value;
            const description = document.getElementById('productDescription').value;
            const basePrice = document.getElementById('productPrice').value;
            const deliveryCharge = document.getElementById('deliveryCharge').value || 0;
            const subImages = document.getElementById('productSubImages').value;
            const category = document.getElementById('productCategory').value;
            
            // Get selected sizes and their prices
            const sizeCheckboxes = document.querySelectorAll('.size-checkbox:checked');
            const sizes = [];
            const sizePricing = {};
            
            sizeCheckboxes.forEach(checkbox => {
                const size = checkbox.value;
                const priceInput = document.getElementById(`price${size}`);
                const sizePrice = priceInput.value || basePrice;
                
                sizes.push(size);
                sizePricing[size] = parseFloat(sizePrice);
            });
            
            if (!name || !imageUrl || !description || !basePrice) {
                showNotification('Please fill in all required fields (name, image, description, base price)', 'warning');
                return;
            }
            
            if (productsData.length >= 20) {
                showNotification('Maximum 20 products allowed', 'warning');
                return;
            }
            
            if (await addProductToFirebase(name, imageUrl, description, basePrice, subImages, category, sizes, sizePricing, deliveryCharge)) {
                document.getElementById('productName').value = '';
                document.getElementById('productImageUrl').value = '';
                document.getElementById('productDescription').value = '';
                document.getElementById('productPrice').value = '';
                document.getElementById('deliveryCharge').value = '0';
                document.getElementById('productSubImages').value = '';
                document.getElementById('productCategory').value = '';
                // Clear size checkboxes and price inputs
                document.querySelectorAll('.size-checkbox').forEach(cb => cb.checked = false);
                ['S', 'M', 'L', 'XL', 'XXL'].forEach(size => {
                    document.getElementById(`price${size}`).value = '';
                });
                showNotification('Product added successfully! üéâ', 'success');
            } else {
                showNotification('Failed to add product. Please try again.', 'error');
            }
        };

        // Load products admin data with search functionality
        function loadProductsAdminData() {
            const productsAdminList = document.getElementById('productsAdminList');
            if (!productsAdminList) return;
            
            productsAdminList.innerHTML = '';
            
            // Get search term
            const searchInput = document.getElementById('productSearchInput');
            const searchTerm = searchInput ? searchInput.value.toLowerCase() : '';
            
            // Filter products based on search term
            const filteredProducts = productsData.filter(product => 
                product.name.toLowerCase().includes(searchTerm)
            );
            
            filteredProducts.forEach(product => {
                const productItem = document.createElement('div');
                productItem.className = 'admin-item';
                productItem.innerHTML = `
                    <div class="item-info">
                        <strong>${product.name}</strong><br>
                        <span>Price: ‚Çπ${product.price}</span><br>
                        <span>Category: ${product.category || 'No category'}</span><br>
                        ${product.sizes && product.sizes.length > 0 ? `<span>Sizes: ${product.sizes.join(', ')}</span><br>` : ''}
                        <small style="color: #999;">ID: ${product.id}</small>
                    </div>
                    <div class="action-buttons">
                        <button class="btn-danger" onclick="removeProduct('${product.id}')">Remove</button>
                    </div>
                `;
                productsAdminList.appendChild(productItem);
            });
            
            // Show message if no products found
            if (filteredProducts.length === 0 && searchTerm) {
                productsAdminList.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">No products found matching your search.</p>';
            }
        }

        // Search products function
        window.searchProducts = function() {
            loadProductsAdminData();
        };

        window.removeProduct = async function(productId) {
            console.log('Attempting to remove product with ID:', productId);
            const success = await removeProductFromFirebase(productId);
            if (success) {
                loadProductsAdminData();
            } else {
                showNotification('Error removing product. Please try again.', 'error');
            }
        };

        // Product detail modal functions
        window.openProductModal = function(productId) {
            const product = productsData.find(p => p.id === productId);
            if (!product) return;
            
            const modal = document.getElementById('productModal');
            const modalBody = document.getElementById('productModalBody');
            modalBody.innerHTML = `
                <img src="${product.imageUrl}" alt="${product.name}" class="product-modal-image" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRjhGOUZBIi8+CjxwYXRoIGQ9Ik03NSA3NUgxMjVWMTI1SDc1Vjc1WiIgZmlsbD0iI0RERERERCIvPgo8L3N2Zz4K'">
                <h3 class="product-modal-name">${product.name}</h3>
                <div class="product-modal-price" id="price-${product.id}">‚Çπ${product.price}</div>
                <p class="product-modal-description">${product.description}</p>
                ${product.category ? `<p><strong>Category:</strong> ${product.category}</p>` : ''}
                ${product.deliveryCharge ? `<p style="color: #27ae60; font-weight: 600;">Delivery Charge: ‚Çπ${product.deliveryCharge}</p>` : ''}
                
                ${product.sizes && product.sizes.length > 0 ? `
                <div style="margin: 15px 0;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #2c3e50;">Size:</label>
                    <select id="size-${product.id}" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 14px;" onchange="updatePriceBySize('${product.id}')">
                        <option value="">Select Size</option>
                        ${product.sizes.map(size => `<option value="${size}">${size}</option>`).join('')}
                    </select>
                </div>
                ` : ''}
                
                <div class="product-modal-quantity">
                    <span class="quantity-label">Quantity:</span>
                    <div class="quantity-controls">
                        <button class="quantity-btn" onclick="changeQuantity('${product.id}', -1)">-</button>
                        <input type="number" id="quantity-${product.id}" class="quantity-input" value="1" min="1" max="10" onchange="updateTotalPrice('${product.id}')">
                        <button class="quantity-btn" onclick="changeQuantity('${product.id}', 1)">+</button>
                    </div>
                    <div class="total-price" id="total-${product.id}">Total: ‚Çπ${product.price}</div>
                </div>
                
                <div class="product-modal-buttons">
                    <button class="btn-cart" onclick="addToCartWithQuantity('${product.id}')">Add to Cart</button>
                    <button class="btn-order" onclick="orderNowWithQuantity('${product.id}')">Order Now</button>
                </div>
            `;
            
            modal.style.display = 'flex';
        };

        // Open product modal from cart (without Add to Cart button)
        window.openProductModalFromCart = function(productId) {
            const product = productsData.find(p => p.id === productId);
            if (!product) return;
            
            // Find the cart item to get its quantity and size
            const cartItem = cartItems.find(item => item.id === productId);
            const quantity = cartItem ? cartItem.quantity : 1;
            const size = cartItem ? cartItem.size : '';
            
            const modal = document.getElementById('productModal');
            const modalBody = document.getElementById('productModalBody');
            // Get size-specific price if available
            let currentPrice = product.price; // base price
            if (size && product.sizePricing && product.sizePricing[size]) {
                currentPrice = product.sizePricing[size];
            }
            
            const deliveryCharge = product.deliveryCharge || 0;
            const totalAmount = (currentPrice * quantity) + deliveryCharge;
            
            modalBody.innerHTML = `
                <img src="${product.imageUrl}" alt="${product.name}" class="product-modal-image" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRjhGOUZBIi8+CjxwYXRoIGQ9Ik03NSA3NUgxMjVWMTI1SDc1Vjc1WiIgZmlsbD0iI0RERERERCIvPgo8L3N2Zz4K'">
                <h3 class="product-modal-name">${product.name}</h3>
                <div class="product-modal-price">‚Çπ${currentPrice}</div>
                <p class="product-modal-description">${product.description}</p>
                ${product.category ? `<p><strong>Category:</strong> ${product.category}</p>` : ''}
                ${size ? `<p><strong>Size:</strong> ${size}</p>` : ''}
                <p><strong>Quantity:</strong> ${quantity}</p>
                <p><strong>Unit Price:</strong> ‚Çπ${currentPrice}</p>
                ${deliveryCharge > 0 ? `<p style="color: #27ae60; font-weight: 600;"><strong>üöö Delivery Charge:</strong> ‚Çπ${deliveryCharge}</p>` : ''}
                <p style="font-size: 18px; font-weight: 700; color: #27ae60;"><strong>Total Amount:</strong> ‚Çπ${totalAmount}</p>
                
                <div class="product-modal-buttons">
                    <button class="btn-order" onclick="orderFromCart('${product.id}')">Order Now</button>
                </div>
            `;
            
            modal.style.display = 'flex';
        };

        window.closeProductModal = function() {
            document.getElementById('productModal').style.display = 'none';
        };

        // Quantity control functions
        // Update price based on selected size
        window.updatePriceBySize = function(productId) {
            const product = productsData.find(p => p.id === productId);
            const sizeSelect = document.getElementById(`size-${productId}`);
            const selectedSize = sizeSelect.value;
            
            let currentPrice = product.price; // base price
            
            // Check if size-specific pricing exists
            if (selectedSize && product.sizePricing && product.sizePricing[selectedSize]) {
                currentPrice = product.sizePricing[selectedSize];
            }
            
            // Update price display
            const priceElement = document.getElementById(`price-${productId}`);
            if (priceElement) {
                priceElement.textContent = `‚Çπ${currentPrice}`;
            }
            
            // Update total price
            updateTotalPrice(productId);
        };

        window.changeQuantity = function(productId, change) {
            const quantityInput = document.getElementById(`quantity-${productId}`);
            let currentQuantity = parseInt(quantityInput.value);
            currentQuantity += change;
            
            if (currentQuantity < 1) currentQuantity = 1;
            if (currentQuantity > 10) currentQuantity = 10;
            
            quantityInput.value = currentQuantity;
            updateTotalPrice(productId);
        };

        window.updateTotalPrice = function(productId) {
            const product = productsData.find(p => p.id === productId);
            const quantity = parseInt(document.getElementById(`quantity-${productId}`).value);
            const sizeSelect = document.getElementById(`size-${productId}`);
            
            let currentPrice = product.price; // base price
            
            // Check if size is selected and has specific pricing
            if (sizeSelect && sizeSelect.value && product.sizePricing && product.sizePricing[sizeSelect.value]) {
                currentPrice = product.sizePricing[sizeSelect.value];
            }
            
            const total = currentPrice * quantity;
            const totalElement = document.getElementById(`total-${productId}`);
            if (totalElement) {
                totalElement.textContent = `Total: ‚Çπ${total}`;
            }
        };

        // Updated cart and order functions with quantity
        window.addToCartWithQuantity = async function(productId) {
            const product = productsData.find(p => p.id === productId);
            const quantityInput = document.getElementById(`quantity-${productId}`);
            const quantity = parseInt(quantityInput.value) || 1;
            
            // Get selected size if available
            let selectedSize = '';
            const sizeSelect = document.getElementById(`size-${productId}`);
            if (sizeSelect && product.sizes && product.sizes.length > 0) {
                selectedSize = sizeSelect.value;
                if (!selectedSize) {
                    showNotification('Please select a size before adding to cart.', 'warning');
                    return;
                }
            }
            
            if (product) {
                // Get size-specific price
                let currentPrice = product.price; // base price
                if (selectedSize && product.sizePricing && product.sizePricing[selectedSize]) {
                    currentPrice = product.sizePricing[selectedSize];
                }
                
                const existingItem = cartItems.find(item => item.id === productId && item.size === selectedSize);
                if (existingItem) {
                    existingItem.quantity += quantity;
                } else {
                    cartItems.push({
                        id: product.id,
                        name: product.name,
                        price: currentPrice,
                        imageUrl: product.imageUrl,
                        quantity: quantity,
                        size: selectedSize
                    });
                }
                
                updateCartCount();
                await saveCartToFirebase();
                const sizeText = selectedSize ? ` (Size: ${selectedSize})` : '';
                showNotification(`${quantity} x ${product.name}${sizeText} added to cart!`, 'success');
                closeProductModal();
            }
        };

        let orderItems = [];

        // Custom notification system
        function showNotification(message, type = 'success', duration = 4000) {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            notification.innerHTML = `
                <button class="notification-close" onclick="this.parentElement.remove()">&times;</button>
                ${message}
            `;
            
            container.appendChild(notification);
            
            // Show notification with animation
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            // Auto remove after duration
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.classList.remove('show');
                    setTimeout(() => {
                        if (notification.parentElement) {
                            notification.remove();
                        }
                    }, 300);
                }
            }, duration);
        }

        // Order function specifically for cart items (like checkout but for single item)
        window.orderFromCart = async function(productId) {
            const product = productsData.find(p => p.id === productId);
            const cartItem = cartItems.find(item => item.id === productId);
            
            if (!product || !cartItem) {
                showNotification('Product not found in cart.', 'error');
                return;
            }
            
            // Reload user address data to ensure it's current
            await loadUserAddressFromFirebase();
            
            // Check if user has address saved with stricter validation
            if (!userAddressData || 
                !userAddressData.phone || 
                !userAddressData.address || 
                userAddressData.phone.trim() === '' || 
                userAddressData.address.trim() === '') {
                
                showNotification('‚ùå Order cannot be placed!<br><br>üìç Please add your delivery address first:<br>1. Go to Profile section<br>2. Click "Edit Address"<br>3. Fill phone number and address<br>4. Save and try ordering again', 'error', 8000);
                
                // Automatically switch to profile section
                setTimeout(() => {
                    setActiveTab('profile');
                }, 1000);
                return;
            }
            
            // Use the cart item's price (which already has size-based pricing)
            const deliveryCharge = product.deliveryCharge || 0;
            const orderData = {
                productId: product.id,
                productName: product.name,
                productPrice: cartItem.price,
                productImage: product.imageUrl,
                productSize: cartItem.size || '',
                quantity: cartItem.quantity,
                deliveryCharge: deliveryCharge,
                totalAmount: (cartItem.price * cartItem.quantity) + deliveryCharge,
                userPhone: userAddressData ? userAddressData.phone : 'Not provided',
                userAddress: userAddressData ? userAddressData.address : 'Not provided',
                orderDate: new Date().toLocaleDateString(),
                status: 'Pending',
                orderType: 'Single Item Order'
            };
            
            // Remove item from cart immediately for real-time effect
            const itemIndex = cartItems.findIndex(item => item.id === productId);
            if (itemIndex > -1) {
                cartItems.splice(itemIndex, 1);
                updateCartCount();
                updateCartDisplay();
                updateCartDisplayMain();
            }
            
            // Close modal immediately
            closeProductModal();
            
            try {
                // Save order to Firebase
                const orderId = await saveOrderToFirebase(orderData);
                
                if (orderId) {
                    // Update cart in Firebase
                    await saveCartToFirebase();
                    
                    // Refresh Orders section in real-time
                    await loadOrdersDataFromFirebase();
                    
                    // Show success message
                    showNotification(`Order placed successfully!<br><br>Product: ${product.name}<br>Quantity: ${cartItem.quantity}<br>Total: ‚Çπ${orderData.totalAmount}`, 'success');
                    
                    console.log('Order placed:', orderData);
                } else {
                    // If order failed, add item back to cart
                    cartItems.push(cartItem);
                    updateCartCount();
                    updateCartDisplay();
                    updateCartDisplayMain();
                    showNotification('Failed to place order. Please try again.', 'error');
                }
            } catch (error) {
                // If error, add item back to cart
                cartItems.push(cartItem);
                updateCartCount();
                updateCartDisplay();
                updateCartDisplayMain();
                console.error('Order error:', error);
                showNotification('Error placing order. Please try again.', 'error');
            }
        };

        window.orderNowWithQuantity = async function(productId) {
            const product = productsData.find(p => p.id === productId);
            const quantityInput = document.getElementById(`quantity-${productId}`);
            const quantity = parseInt(quantityInput.value) || 1;
            
            // Get selected size if available
            let selectedSize = '';
            const sizeSelect = document.getElementById(`size-${productId}`);
            if (sizeSelect && product.sizes && product.sizes.length > 0) {
                selectedSize = sizeSelect.value;
                if (!selectedSize) {
                    showNotification('Please select a size before placing order.', 'warning');
                    return;
                }
            }
            
            if (product) {
                // Reload user address data to ensure it's current
                await loadUserAddressFromFirebase();
                
                // Check if user has address saved with stricter validation
                if (!userAddressData || 
                    !userAddressData.phone || 
                    !userAddressData.address || 
                    userAddressData.phone.trim() === '' || 
                    userAddressData.address.trim() === '') {
                    
                    showNotification('‚ùå Order cannot be placed!<br><br>üìç Please add your delivery address first:<br>1. Go to Profile section<br>2. Click "Edit Address"<br>3. Fill phone number and address<br>4. Save and try ordering again', 'error', 8000);
                    
                    // Automatically switch to profile section
                    setTimeout(() => {
                        setActiveTab('profile');
                    }, 1000);
                    return;
                }
                
                // Get size-specific price
                let currentPrice = product.price; // base price
                if (selectedSize && product.sizePricing && product.sizePricing[selectedSize]) {
                    currentPrice = product.sizePricing[selectedSize];
                }
                
                const deliveryCharge = product.deliveryCharge || 0;
                const orderData = {
                    productId: product.id,
                    productName: product.name,
                    productPrice: currentPrice,
                    productImage: product.imageUrl,
                    productSize: selectedSize,
                    quantity: quantity,
                    deliveryCharge: deliveryCharge,
                    totalAmount: (currentPrice * quantity) + deliveryCharge,
                    userPhone: userAddressData.phone,
                    userAddress: userAddressData.address,
                    orderDate: new Date().toLocaleDateString(),
                    status: 'Pending'
                };
                
                const orderId = await saveOrderToFirebase(orderData);
                if (orderId) {
                    showNotification(`Order placed successfully! üéâ<br>Order ID: ${orderId}<br>Total: ‚Çπ${orderData.totalAmount}`, 'success', 6000);
                    closeProductModal();
                } else {
                    showNotification('Error placing order. Please try again.', 'error');
                }
            }
        };

        // Close modal when clicking outside
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('productModal');
            if (event.target === modal) {
                closeProductModal();
            }
        });

        // Show all products when clicking outside categories
        window.showAllProducts = function() {
            selectedCategory = '';
            updateProductsDisplay();
        };

        // Cart functionality
        window.openCart = function() {
            document.getElementById('cartSidebar').classList.add('open');
            document.getElementById('cartOverlay').style.display = 'block';
            updateCartDisplay();
        };

        window.closeCart = function() {
            document.getElementById('cartSidebar').classList.remove('open');
            document.getElementById('cartOverlay').style.display = 'none';
        };

        window.addToCart = async function(productId) {
            if (!currentUser) {
                showNotification('Please login or register to add items to cart! üîê', 'warning', 4000);
                showLoginModal();
                return;
            }
            
            const product = productsData.find(p => p.id === productId);
            if (product) {
                const existingItem = cartItems.find(item => item.id === productId);
                if (existingItem) {
                    existingItem.quantity += 1;
                } else {
                    cartItems.push({
                        id: product.id,
                        name: product.name,
                        price: product.price,
                        imageUrl: product.imageUrl,
                        quantity: 1
                    });
                }
                updateCartCount();
                updateCartDisplay();
                updateCartDisplayMain();
                await saveCartToFirebase();
                showNotification(`${product.name} added to cart! üõí`, 'success');
            }
        };

        // Cancel Order Function
        window.cancelOrder = async function(orderId) {
            const success = await cancelOrderFromFirebase(orderId);
            if (success) {
                showNotification('Order cancelled successfully! ‚ùå', 'success');
                loadOrdersDataFromFirebase(); // Refresh orders list
            } else {
                showNotification('Error cancelling order. Please try again.', 'error');
            }
        };

        // Address Form Functions
        window.showAddressForm = async function() {
            const modal = document.getElementById('addressModal');
            modal.style.display = 'flex';
            
            // Load existing address data
            await loadUserAddressFromFirebase();
            if (userAddressData) {
                document.getElementById('userPhone').value = userAddressData.phone;
                document.getElementById('userAddress').value = userAddressData.address;
                
                // Show current address
                document.getElementById('displayPhone').textContent = `Phone: ${userAddressData.phone}`;
                document.getElementById('displayAddress').textContent = `Address: ${userAddressData.address}`;
                document.getElementById('currentAddressDisplay').style.display = 'block';
            }
        };

        window.closeAddressModal = function() {
            document.getElementById('addressModal').style.display = 'none';
        };

        window.saveUserAddress = async function() {
            const phone = document.getElementById('userPhone').value.trim();
            const address = document.getElementById('userAddress').value.trim();
            
            if (!phone || !address) {
                showNotification('Please fill in both phone number and address', 'warning');
                return;
            }
            
            const success = await saveUserAddressToFirebase(phone, address);
            if (success) {
                userAddressData = { phone, address };
                showNotification('Address saved successfully! üìç', 'success');
                
                // Update display
                document.getElementById('displayPhone').textContent = `Phone: ${phone}`;
                document.getElementById('displayAddress').textContent = `Address: ${address}`;
                document.getElementById('currentAddressDisplay').style.display = 'block';
            } else {
                showNotification('Error saving address. Please try again.', 'error');
            }
        };

        function updateCartCount() {
            const totalItems = cartItems.reduce((sum, item) => sum + item.quantity, 0);
            
            // Update bottom navbar cart count
            const cartCountBottom = document.getElementById('cartCountBottom');
            if (cartCountBottom) {
                cartCountBottom.textContent = totalItems;
                cartCountBottom.style.display = totalItems > 0 ? 'flex' : 'none';
            }
        }

        function updateCartDisplay() {
            const cartItemsContainer = document.getElementById('cartItems');
            const cartTotal = document.getElementById('cartTotal');
            const cartTotalAmount = document.getElementById('cartTotalAmount');
            
            if (cartItems.length === 0) {
                cartItemsContainer.innerHTML = '<div class="cart-empty">Your cart is empty</div>';
                cartTotal.style.display = 'none';
                return;
            }
            
            cartItemsContainer.innerHTML = '';
            let total = 0;
            
            cartItems.forEach(item => {
                total += item.price * item.quantity;
                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';
                cartItem.innerHTML = `
                    <img src="${item.imageUrl}" alt="${item.name}" class="cart-item-image" onclick="openProductModalFromCart('${item.id}')" style="cursor: pointer;">
                    <div class="cart-item-info" onclick="openProductModalFromCart('${item.id}')" style="cursor: pointer;">
                        <div class="cart-item-name">${item.name}</div>
                        ${item.size ? `<div style="color: #666; font-size: 12px;">Size: ${item.size}</div>` : ''}
                        <div class="cart-item-price">‚Çπ${item.price} x ${item.quantity}</div>
                    </div>
                    <button class="cart-item-remove" onclick="removeFromCart('${item.id}')">Remove</button>
                `;
                cartItemsContainer.appendChild(cartItem);
            });
            
            cartTotalAmount.textContent = `Total: ‚Çπ${total}`;
            cartTotal.style.display = 'block';
        }

        // Update cart display for main page section
        function updateCartDisplayMain() {
            const cartItemsContainer = document.getElementById('cartItemsMain');
            const cartTotal = document.getElementById('cartTotalMain');
            const cartTotalAmount = document.getElementById('cartTotalAmountMain');
            
            if (cartItems.length === 0) {
                cartItemsContainer.innerHTML = '<div class="cart-empty-main">Your cart is empty<br>Add some products to get started!</div>';
                cartTotal.style.display = 'none';
                return;
            }
            
            cartItemsContainer.innerHTML = '';
            let total = 0;
            
            cartItems.forEach(item => {
                total += item.price * item.quantity;
                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item-main';
                cartItem.innerHTML = `
                    <img src="${item.imageUrl}" alt="${item.name}" class="cart-item-image-main" onclick="openProductModalFromCart('${item.id}')">
                    <div class="cart-item-info-main" onclick="openProductModalFromCart('${item.id}')">
                        <div class="cart-item-name-main">${item.name}</div>
                        ${item.size ? `<div style="color: #666; font-size: 12px; margin-bottom: 3px;">Size: ${item.size}</div>` : ''}
                        <div class="cart-item-price-main">‚Çπ${item.price} x ${item.quantity}</div>
                    </div>
                    <button class="cart-item-remove-main" onclick="removeFromCart('${item.id}')">Remove</button>
                `;
                cartItemsContainer.appendChild(cartItem);
            });
            
            cartTotalAmount.textContent = `Total: ‚Çπ${total}`;
            cartTotal.style.display = 'block';
        }

        window.removeFromCart = async function(productId) {
            const removedItem = cartItems.find(item => item.id === productId);
            cartItems = cartItems.filter(item => item.id !== productId);
            updateCartCount();
            updateCartDisplay();
            updateCartDisplayMain();
            await saveCartToFirebase();
            
            // Show removal notification
            if (removedItem) {
                showNotification(`${removedItem.name} removed from cart! üóëÔ∏è`, 'success');
            }
        };

        window.checkout = async function() {
            if (cartItems.length === 0) {
                showNotification('Your cart is empty! üõí', 'warning');
                return;
            }
            
            // Reload user address data to ensure it's current
            await loadUserAddressFromFirebase();
            
            // Check if user has address saved with stricter validation
            if (!userAddressData || 
                !userAddressData.phone || 
                !userAddressData.address || 
                userAddressData.phone.trim() === '' || 
                userAddressData.address.trim() === '') {
                
                showNotification('‚ùå Order cannot be placed!<br><br>üìç Please add your delivery address first:<br>1. Go to Profile section<br>2. Click "Edit Address"<br>3. Fill phone number and address<br>4. Save and try ordering again', 'error', 8000);
                
                // Automatically switch to profile section
                setTimeout(() => {
                    setActiveTab('profile');
                }, 1000);
                return;
            }
            
            const total = cartItems.reduce((sum, item) => {
                const product = productsData.find(p => p.id === item.id);
                const deliveryCharge = product ? (product.deliveryCharge || 0) : 0;
                return sum + (item.price * item.quantity) + deliveryCharge;
            }, 0);
            
            // Create order for each cart item
            const orderPromises = cartItems.map(item => {
                const product = productsData.find(p => p.id === item.id);
                const deliveryCharge = product ? (product.deliveryCharge || 0) : 0;
                const orderData = {
                    productId: item.id,
                    productName: item.name,
                    productPrice: item.price,
                    productImage: item.imageUrl,
                    productSize: item.size || '',
                    quantity: item.quantity,
                    deliveryCharge: deliveryCharge,
                    totalAmount: (item.price * item.quantity) + deliveryCharge,
                    userPhone: userAddressData.phone,
                    userAddress: userAddressData.address,
                    orderDate: new Date().toLocaleDateString(),
                    status: 'Pending',
                    orderType: 'Cart Checkout'
                };
                return saveOrderToFirebase(orderData);
            });
            
            try {
                const orderIds = await Promise.all(orderPromises);
                const successfulOrders = orderIds.filter(id => id);
                
                if (successfulOrders.length === cartItems.length) {
                    showNotification(`Checkout successful! üéâ<br>${successfulOrders.length} orders placed<br>Total amount: ‚Çπ${total}`, 'success', 6000);
                    cartItems = [];
                    updateCartCount();
                    updateCartDisplay();
                    updateCartDisplayMain();
                    await saveCartToFirebase(); // Clear cart in Firebase
                    
                    // Refresh Orders section in real-time
                    await loadOrdersDataFromFirebase();
                    
                    closeCart();
                } else {
                    showNotification('Some orders failed to process. Please try again.', 'error');
                }
            } catch (error) {
                console.error('Checkout error:', error);
                showNotification('Error during checkout. Please try again.', 'error');
            }
        };

        window.orderNow = async function(productId) {
            if (!currentUser) {
                showNotification('Please login or register to place orders! üîê', 'warning', 4000);
                showLoginModal();
                return;
            }
            
            const product = productsData.find(p => p.id === productId);
            if (product) {
                // Reload user address data to ensure it's current
                await loadUserAddressFromFirebase();
                
                // Check if user has address saved with stricter validation
                if (!userAddressData || 
                    !userAddressData.phone || 
                    !userAddressData.address || 
                    userAddressData.phone.trim() === '' || 
                    userAddressData.address.trim() === '') {
                    
                    showNotification('‚ùå Order cannot be placed!<br><br>üìç Please add your delivery address first:<br>1. Go to Profile section<br>2. Click "Edit Address"<br>3. Fill phone number and address<br>4. Save and try ordering again', 'error', 8000);
                    
                    // Automatically switch to profile section
                    setTimeout(() => {
                        setActiveTab('profile');
                    }, 1000);
                    return;
                }
                
                const orderData = {
                    productId: product.id,
                    productName: product.name,
                    productPrice: product.price,
                    productImage: product.imageUrl,
                    quantity: 1,
                    totalAmount: product.price,
                    userPhone: userAddressData.phone,
                    userAddress: userAddressData.address,
                    orderDate: new Date().toLocaleDateString(),
                    status: 'Pending'
                };
                
                const orderId = await saveOrderToFirebase(orderData);
                if (orderId) {
                    showNotification(`Order placed successfully! üéâ<br>Order ID: ${orderId}<br>Total: ‚Çπ${orderData.totalAmount}`, 'success', 6000);
                } else {
                    showNotification('Error placing order. Please try again.', 'error');
                }
            }
        };

        // Check authentication before accessing protected features
        window.checkAuthAndSetTab = function(tab) {
            console.log('checkAuthAndSetTab called with:', tab, 'currentUser:', currentUser);
            if (!currentUser) {
                showNotification('Please login or register to use app features! üîê', 'warning', 4000);
                showLoginModal();
                return;
            }
            console.log('User authenticated, setting tab:', tab);
            setActiveTab(tab);
        };

        // App Navigation functionality
        window.setActiveTab = function(tab) {
            console.log('Setting active tab:', tab);
            
            // Remove active class from all tabs
            document.querySelectorAll('.app-nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Add active class to clicked tab - find the correct nav item
            const navItems = document.querySelectorAll('.app-nav-item');
            navItems.forEach(item => {
                const label = item.querySelector('.app-nav-label');
                if (label && label.textContent.toLowerCase() === tab.toLowerCase()) {
                    item.classList.add('active');
                }
            });
            
            // Hide all sections
            document.querySelectorAll('.app-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show selected section
            switch(tab) {
                case 'home':
                    document.getElementById('homeSection').classList.add('active');
                    break;
                case 'search':
                    document.getElementById('searchSection').classList.add('active');
                    loadAllProductsInSearch();
                    break;
                case 'cart':
                    console.log('Activating cart section');
                    const cartSection = document.getElementById('cartSection');
                    if (cartSection) {
                        cartSection.classList.add('active');
                        console.log('Cart section activated, updating display');
                        updateCartDisplayMain();
                    } else {
                        console.error('Cart section not found!');
                    }
                    break;
                case 'orders':
                    document.getElementById('ordersSection').classList.add('active');
                    loadOrdersDataFromFirebase();
                    break;
                case 'profile':
                    document.getElementById('profileSection').classList.add('active');
                    updateProfileInfo();
                    break;
            }
        };

        // Search functionality
        window.performSearch = function() {
            const searchInput = document.getElementById('searchInput');
            const searchTerm = searchInput.value.trim();
            
            if (searchTerm) {
                searchProductsInSection(searchTerm);
            } else {
                loadAllProductsInSearch();
            }
        };

        // Add real-time search
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    const searchTerm = this.value.trim();
                    if (searchTerm) {
                        searchProductsInSection(searchTerm);
                    } else {
                        loadAllProductsInSearch();
                    }
                });
            }
        });

        function loadAllProductsInSearch() {
            const searchProductsGrid = document.getElementById('searchProductsGrid');
            if (!searchProductsGrid) return;
            
            searchProductsGrid.innerHTML = '';
            
            productsData.forEach(product => {
                const productCard = createProductCard(product);
                searchProductsGrid.appendChild(productCard);
            });
        }

        function searchProductsInSection(searchTerm) {
            const filteredProducts = productsData.filter(product => 
                product.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                product.description.toLowerCase().includes(searchTerm.toLowerCase()) ||
                (product.category && product.category.toLowerCase().includes(searchTerm.toLowerCase()))
            );
            
            const searchProductsGrid = document.getElementById('searchProductsGrid');
            if (!searchProductsGrid) return;
            
            searchProductsGrid.innerHTML = '';
            
            if (filteredProducts.length === 0) {
                searchProductsGrid.innerHTML = `<p style="text-align: center; color: #666; grid-column: 1 / -1; padding: 40px;">No products found for "${searchTerm}".</p>`;
                return;
            }
            
            filteredProducts.forEach(product => {
                const productCard = createProductCard(product);
                searchProductsGrid.appendChild(productCard);
            });
        }

        function createProductCard(product) {
            const productCard = document.createElement('div');
            productCard.className = 'product-card';
            productCard.onclick = () => openProductModal(product.id);
            productCard.innerHTML = `
                <img src="${product.imageUrl}" alt="${product.name}" class="product-image" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgdmlld0JveD0iMCAwIDIwMCAxNTAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMTUwIiBmaWxsPSIjZjNmNGY2Ii8+Cjx0ZXh0IHg9IjEwMCIgeT0iNzUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OWFhMiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk5vIEltYWdlPC90ZXh0Pgo8L3N2Zz4K'">
                <div class="product-info">
                    <h3 class="product-name">${product.name}</h3>
                    <div class="product-price">‚Çπ${product.price}</div>
                    <div class="product-buttons">
                        <button class="btn-cart" onclick="event.stopPropagation(); addToCart('${product.id}')">Add to Cart</button>
                        <button class="btn-order" onclick="event.stopPropagation(); orderNow('${product.id}')">Order Now</button>
                    </div>
                </div>
            `;
            return productCard;
        }

        function updateProfileInfo() {
            if (currentUser) {
                document.getElementById('profileName').textContent = currentUser.displayName || 'User';
                document.getElementById('profileEmail').textContent = currentUser.email || 'user@email.com';
                document.getElementById('profileImage').src = currentUser.photoURL || '';
            }
        }

        // Load and display orders from Firebase
        async function loadOrdersDataFromFirebase() {
            const ordersContent = document.getElementById('ordersContent');
            const noOrdersMessage = document.getElementById('noOrdersMessage');
            
            try {
                const orders = await loadOrdersFromFirebase();
                
                if (orders.length === 0) {
                    noOrdersMessage.style.display = 'block';
                    // Clear existing orders
                    const existingOrders = ordersContent.querySelectorAll('.order-item');
                    existingOrders.forEach(order => order.remove());
                    return;
                }
                
                noOrdersMessage.style.display = 'none';
                
                // Clear existing orders except the no orders message
                const existingOrders = ordersContent.querySelectorAll('.order-item');
                existingOrders.forEach(order => order.remove());
                
                orders.forEach(order => {
                    const orderElement = document.createElement('div');
                    orderElement.className = 'order-item';
                    orderElement.style.cssText = `
                        background: white;
                        border-radius: 12px;
                        padding: 15px;
                        margin-bottom: 15px;
                        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
                        border: 1px solid #f0f0f0;
                        transition: transform 0.2s ease, box-shadow 0.2s ease;
                        width: 100%;
                        box-sizing: border-box;
                        overflow: hidden;
                    `;
                    
                    // Add hover effect
                    orderElement.addEventListener('mouseenter', () => {
                        orderElement.style.transform = 'translateY(-1px)';
                        orderElement.style.boxShadow = '0 6px 20px rgba(0, 0, 0, 0.12)';
                    });
                    orderElement.addEventListener('mouseleave', () => {
                        orderElement.style.transform = 'translateY(0)';
                        orderElement.style.boxShadow = '0 4px 15px rgba(0, 0, 0, 0.08)';
                    });
                    
                    orderElement.innerHTML = `
                        <!-- Top section: Image + Name/Description -->
                        <div style="display: flex; gap: 12px; align-items: flex-start; margin-bottom: 15px;">
                            <div style="flex-shrink: 0;">
                                <img src="${order.productImage}" alt="${order.productName}" 
                                     style="width: 70px; height: 70px; object-fit: contain; border-radius: 8px; background: #f8f9fa; border: 1px solid #e9ecef;"
                                     onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNzAiIGhlaWdodD0iNzAiIHZpZXdCb3g9IjAgMCA3MCA3MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjcwIiBoZWlnaHQ9IjcwIiBmaWxsPSIjRjhGOUZBIi8+CjxwYXRoIGQ9Ik0yNSAyNUg0NVY0NUgyNVYyNVoiIGZpbGw9IiNEREREREQiLz4KPC9zdmc+Cg=='">
                            </div>
                            <div style="flex: 1; min-width: 0;">
                                <h3 style="font-size: 16px; font-weight: 700; color: #2c3e50; margin: 0 0 5px 0; line-height: 1.3; word-break: break-word;">${order.productName}</h3>
                                <div style="font-size: 12px; color: #666; margin-bottom: 3px;">Order ID: <span style="font-family: monospace; background: #f8f9fa; padding: 1px 4px; border-radius: 3px;">${order.id.substring(0, 12)}...</span></div>
                                <div style="font-size: 12px; color: #666;">üìÖ ${order.orderDate}</div>
                            </div>
                        </div>
                        
                        <!-- Middle section: Half width for quantity/amount/size, Half width for total -->
                        <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                            <div style="flex: 1; background: #f8f9fa; padding: 10px; border-radius: 6px;">
                                <div style="font-size: 13px; color: #666; margin-bottom: 3px;">Quantity: <strong>${order.quantity}</strong></div>
                                <div style="font-size: 13px; color: #666; margin-bottom: 3px;">Unit Price: ‚Çπ${order.productPrice}</div>
                                ${order.productSize ? `<div style="font-size: 13px; color: #666; margin-bottom: 3px;">Size: <strong>${order.productSize}</strong></div>` : ''}
                                ${order.deliveryCharge ? `<div style="font-size: 13px; color: #27ae60; font-weight: 600;">üöö Delivery: ‚Çπ${order.deliveryCharge}</div>` : ''}
                            </div>
                            <div style="flex: 1; background: #e8f5e8; padding: 10px; border-radius: 6px; text-align: center; display: flex; flex-direction: column; justify-content: center;">
                                <div style="font-size: 12px; color: #27ae60; margin-bottom: 2px;">Total Amount</div>
                                <div style="font-size: 18px; font-weight: 700; color: #27ae60;">‚Çπ${order.totalAmount + (order.deliveryCharge || 0)}</div>
                            </div>
                        </div>
                        
                        <!-- Status section: Full width -->
                        <div style="width: 100%; margin-bottom: 15px; text-align: center;">
                            <span style="background: ${order.status === 'Pending' ? '#fff3cd' : (order.status === 'Rejected' ? '#f8d7da' : '#d4edda')}; color: ${order.status === 'Pending' ? '#856404' : (order.status === 'Rejected' ? '#721c24' : '#155724')}; padding: 8px 20px; border-radius: 20px; font-size: 12px; font-weight: 600; text-transform: uppercase; display: inline-block;">
                                ${order.status === 'Pending' ? '‚è≥' : (order.status === 'Rejected' ? '‚ùå' : '‚úÖ')} ${order.status}
                            </span>
                        </div>
                        
                        <!-- Delivery info -->
                        <div style="background: #f0f8ff; padding: 10px; border-radius: 6px; margin-bottom: 15px; font-size: 12px; color: #666;">
                            <div style="font-weight: 600; margin-bottom: 5px; color: #2c3e50;">üöö Delivery Information:</div>
                            <div style="margin-bottom: 3px;">üìû Phone: ${order.userPhone || 'Not provided'}</div>
                            <div>üìç Address: ${order.userAddress || 'Not provided'}</div>
                        </div>
                        
                        <!-- Cancel button: Only show for Pending orders -->
                        ${order.status === 'Pending' ? `
                        <button onclick="cancelOrder('${order.id}')" 
                                style="width: 100%; background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);"
                                onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 6px 20px rgba(231, 76, 60, 0.4)'"
                                onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(231, 76, 60, 0.3)'">
                            ‚ùå Cancel Order
                        </button>
                        ` : (order.status === 'Completed' || order.status === 'Rejected') ? `
                        <div style="width: 100%; text-align: center; padding: 12px; background: ${order.status === 'Completed' ? '#d4edda' : '#f8d7da'}; border-radius: 8px; color: ${order.status === 'Completed' ? '#155724' : '#721c24'}; font-size: 14px; font-weight: 600; margin-bottom: 10px;">
                            ${order.status === 'Completed' ? '‚úÖ Order Completed' : '‚ùå Order Rejected'}
                        </div>
                        <div id="timer-${order.id}" style="width: 100%; text-align: center; padding: 10px; background: #fff3cd; border-radius: 8px; color: #856404; font-size: 13px; font-weight: 600; border: 1px solid #ffeaa7;">
                            ‚è∞ Auto-delete in: <span id="countdown-${order.id}">Loading...</span>
                        </div>
                        ` : `
                        <div style="width: 100%; text-align: center; padding: 12px; background: #f8f9fa; border-radius: 8px; color: #666; font-size: 14px; font-weight: 600;">
                            ‚ùå Order Cancelled
                        </div>
                        `}
                    `;
                    ordersContent.appendChild(orderElement);
                    
                    // Start countdown timer for completed/rejected orders
                    if (order.status === 'Completed' || order.status === 'Rejected') {
                        startCountdownTimer(order.id, order.completedAt || order.rejectedAt);
                    }
                });
            } catch (error) {
                console.error('Error loading orders:', error);
                noOrdersMessage.textContent = 'Error loading orders. Please try again.';
                noOrdersMessage.style.display = 'block';
            }
        }

        function searchProducts(searchTerm) {
            const filteredProducts = productsData.filter(product => 
                product.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                product.description.toLowerCase().includes(searchTerm.toLowerCase())
            );
            
            const productsGrid = document.getElementById('productsGrid');
            if (!productsGrid) return;
            
            productsGrid.innerHTML = '';
            
            if (filteredProducts.length === 0) {
                productsGrid.innerHTML = `<p style="text-align: center; color: #666; grid-column: 1 / -1;">No products found for "${searchTerm}".</p>`;
                return;
            }
            
            filteredProducts.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                productCard.onclick = () => openProductModal(product.id);
                productCard.innerHTML = `
                    <img src="${product.imageUrl}" alt="${product.name}" class="product-image" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgdmlld0JveD0iMCAwIDIwMCAxNTAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMTUwIiBmaWxsPSIjZjNmNGY2Ii8+Cjx0ZXh0IHg9IjEwMCIgeT0iNzUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OWFhMiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk5vIEltYWdlPC90ZXh0Pgo8L3N2Zz4K'">
                    <div class="product-info">
                        <h3 class="product-name">${product.name}</h3>
                        <div class="product-price">‚Çπ${product.price}</div>
                        <div class="product-buttons">
                            <button class="btn-cart" onclick="event.stopPropagation(); addToCart('${product.id}')">Add to Cart</button>
                            <button class="btn-order" onclick="event.stopPropagation(); orderNow('${product.id}')">Order Now</button>
                        </div>
                    </div>
                `;
                productsGrid.appendChild(productCard);
            });
        }

        // Check if user is admin
        function isAdmin(email) {
            return adminUsers.includes(email);
        }

        // Show/hide admin button based on user role
        function updateAdminVisibility(user) {
            const adminBtn = document.getElementById('adminBtn');
            if (adminBtn && user && isAdmin(user.email)) {
                adminBtn.style.display = 'block';
            } else if (adminBtn) {
                adminBtn.style.display = 'none';
            }
        }

        // Add user to registered users list
        function addRegisteredUser(user) {
            const existingUser = registeredUsers.find(u => u.email === user.email);
            if (!existingUser) {
                registeredUsers.push({
                    name: user.displayName,
                    email: user.email,
                    isAdmin: isAdmin(user.email)
                });
                saveData();
            }
        }

        // Admin Panel Functions
        window.openAdminPanel = function() {
            document.getElementById('adminPanel').style.display = 'flex';
            loadAdminData();
        };

        window.closeAdminPanel = function() {
            document.getElementById('adminPanel').style.display = 'none';
        };

        window.showTab = function(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName + 'Tab').classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'slides') {
                loadSlidesData();
            } else if (tabName === 'categories') {
                loadCategoriesAdminData();
            } else if (tabName === 'products') {
                loadProductsAdminData();
            } else if (tabName === 'users') {
                loadUsersData();
            } else if (tabName === 'ordersAdmin') {
                loadPendingOrdersForAdmin();
            }
        };

        // Slideshow Management
        window.addSlide = async function() {
            const title = document.getElementById('slideTitle').value;
            const url = document.getElementById('slideUrl').value;
            
            if (!title || !url) {
                showNotification('Please fill in both title and URL', 'warning');
                return;
            }
            
            if (slidesData.length >= 5) {
                showNotification('Maximum 5 slides allowed', 'warning');
                return;
            }
            
            // Add to Firebase instead of localStorage
            const success = await addSlideToFirebase(title, url);
            if (success) {
                loadSlidesData();
                // Clear form
                document.getElementById('slideTitle').value = '';
                document.getElementById('slideUrl').value = '';
            } else {
                showNotification('Error adding slide. Please try again.', 'error');
            }
        };

        window.removeSlide = async function(slideId) {
            console.log('Attempting to remove slide with ID:', slideId);
            const success = await removeSlideFromFirebase(slideId);
            if (success) {
                loadSlidesData();
            } else {
                showNotification('Error removing slide. Please try again.', 'error');
            }
        }

        function loadSlidesData() {
            const slidesList = document.getElementById('slidesList');
            slidesList.innerHTML = '';
            
            slidesData.forEach((slide, index) => {
                const slideItem = document.createElement('div');
                slideItem.className = 'slide-item';
                slideItem.innerHTML = `
                    <div class="slide-info">
                        <div class="slide-title-admin">${slide.title}</div>
                        <div class="slide-url">${slide.originalUrl || slide.url}</div>
                        <small style="color: #999;">ID: ${slide.id}</small>
                    </div>
                    <div class="action-buttons">
                        <button class="btn-danger" onclick="removeSlide('${slide.id}')">Remove</button>
                    </div>
                `;
                slidesList.appendChild(slideItem);
            });
        }

        // User Management
        window.toggleAdmin = function(email) {
            if (email === 'moghaeashu@gmail.com') {
                showNotification('Cannot modify permanent admin', 'warning');
                return;
            }
            
            const userIndex = registeredUsers.findIndex(u => u.email === email);
            if (userIndex !== -1) {
                const isCurrentlyAdmin = adminUsers.includes(email);
                
                if (isCurrentlyAdmin) {
                    adminUsers = adminUsers.filter(admin => admin !== email);
                    registeredUsers[userIndex].isAdmin = false;
                } else {
                    adminUsers.push(email);
                    registeredUsers[userIndex].isAdmin = true;
                }
                
                saveData();
                loadUsersData();
            }
        };

        function loadUsersData() {
            const usersList = document.getElementById('usersList');
            usersList.innerHTML = '';
            
            registeredUsers.forEach(user => {
                const userItem = document.createElement('div');
                userItem.className = 'user-item';
                const isPermanentAdmin = user.email === 'moghaeashu@gmail.com';
                
                userItem.innerHTML = `
                    <div class="user-info">
                        <div class="user-name">${user.name}${user.isAdmin ? '<span class="admin-badge">ADMIN</span>' : ''}</div>
                        <div class="user-email">${user.email}</div>
                    </div>
                    <div class="action-buttons">
                        ${!isPermanentAdmin ? 
                            `<button class="${user.isAdmin ? 'btn-danger' : 'btn-success'}" onclick="toggleAdmin('${user.email}')">
                                ${user.isAdmin ? 'Remove Admin' : 'Make Admin'}
                            </button>` : 
                            '<span style="color: #f39c12; font-size: 12px;">Permanent Admin</span>'
                        }
                    </div>
                `;
                usersList.appendChild(userItem);
            });
        }

        function loadAdminData() {
            loadSlidesData();
            loadUsersData();
        }

        // Update slideshow with current data
        function updateSlideshow() {
            console.log('Updating slideshow with', slidesData.length, 'slides');
            const slideshowContainer = document.querySelector('.slideshow-container');
            const dotsContainer = document.querySelector('.dots-container');
            
            if (!slideshowContainer || !dotsContainer) {
                console.error('Slideshow containers not found');
                return;
            }
            
            // Clear existing slides
            const existingSlides = slideshowContainer.querySelectorAll('.slides');
            existingSlides.forEach(slide => slide.remove());
            
            // Clear existing dots
            dotsContainer.innerHTML = '';
            
            // If no slides, show empty message
            if (slidesData.length === 0) {
                slideshowContainer.innerHTML = '<div style="padding: 50px; text-align: center; color: #666;">No slides added yet. Admin can add slides through the admin panel.</div>';
                console.log('Showing empty state message');
                return;
            }
            
            // Add new slides
            slidesData.forEach((slide, index) => {
                console.log(`Adding slide ${index + 1}:`, slide.title, slide.url);
                const slideDiv = document.createElement('div');
                slideDiv.className = 'slides';
                if (index === 0) slideDiv.classList.add('active');
                
                slideDiv.innerHTML = `
                    <img src="${slide.url}" 
                         alt="${slide.title}" 
                         style="width: 100%; height: 250px; object-fit: cover;"
                         onload="console.log('Image loaded successfully:', this.src)"
                         onerror="
                            console.error('Failed to load image:', this.src);
                            const fileId = '${slide.url}'.match(/\/d\/([a-zA-Z0-9_-]+)/);
                            if (fileId && fileId[1]) {
                                console.log('Trying alternative URL format...');
                                this.src = 'https://drive.google.com/uc?export=view&id=' + fileId[1];
                                this.onerror = function() {
                                    console.log('Alternative format also failed, trying thumbnail...');
                                    this.src = 'https://drive.google.com/thumbnail?id=' + fileId[1] + '&sz=w800-h400';
                                    this.onerror = function() {
                                        console.log('All formats failed, showing placeholder');
                                        this.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAwIiBoZWlnaHQ9IjQwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZGRkIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIyMCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkltYWdlIE5vdCBGb3VuZDwvdGV4dD48L3N2Zz4=';
                                    };
                                };
                            }
                         ">
                    <div class="slide-content">
                        <div class="slide-title">${slide.title}</div>
                        <div class="slide-description">Discover amazing products and deals</div>
                    </div>
                `;
                
                slideshowContainer.appendChild(slideDiv);
                
                // Add dot
                const dot = document.createElement('span');
                dot.className = 'dot';
                if (index === 0) dot.classList.add('active');
                dot.onclick = () => currentSlide(index + 1);
                dotsContainer.appendChild(dot);
            });
            
            // Reset slideshow
            slideIndex = 0;
            stopSlideshow();
            if (slidesData.length > 1) {
                startSlideshow();
            }
            
            console.log('Slideshow updated successfully');
        }

        // Cart functionality and form handlers
        document.addEventListener('DOMContentLoaded', async function() {
            await loadData(); // Load data from Firebase and localStorage
            
            const cartBtn = document.querySelector('.cart-btn');
            if (cartBtn) {
                cartBtn.addEventListener('click', function() {
                    showNotification('Cart functionality is already implemented! üõí', 'info');
                });
            }
            
            // Add form event listeners
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            
            if (loginForm) {
                loginForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    const email = document.getElementById('loginEmail').value.trim();
                    const password = document.getElementById('loginPassword').value;
                    
                    if (!email || !password) {
                        showNotification('Please fill in all fields', 'error');
                        return;
                    }
                    
                    await loginWithEmail(email, password);
                });
            }
            
            if (registerForm) {
                registerForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    const name = document.getElementById('registerName').value.trim();
                    const email = document.getElementById('registerEmail').value.trim();
                    const password = document.getElementById('registerPassword').value;
                    const confirmPassword = document.getElementById('confirmPassword').value;
                    
                    // Validation
                    if (!name || !email || !password || !confirmPassword) {
                        showNotification('Please fill in all fields', 'error');
                        return;
                    }
                    
                    if (password.length < 6) {
                        showNotification('Password must be at least 6 characters', 'error');
                        return;
                    }
                    
                    if (password !== confirmPassword) {
                        showNotification('Passwords do not match', 'error');
                        return;
                    }
                    
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailRegex.test(email)) {
                        showNotification('Please enter a valid email address', 'error');
                        return;
                    }
                    
                    await registerWithEmail(name, email, password);
                });
            }
            
            // Initialize slideshow when page loads
            setTimeout(() => {
                updateSlideshow();
            }, 500);
        });
    </script>
</body>
</html>
